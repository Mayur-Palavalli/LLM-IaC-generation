{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyEFSFileSystem": {"Type": "AWS::EFS::FileSystem", "Properties": {"Encrypted": true, "LifecyclePolicies": [{"TransitionToIA": "AFTER_30_DAYS"}], "PerformanceMode": "generalPurpose", "ThroughputMode": "bursting"}}, "MyMountTargetA": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "MyEFSFileSystem"}, "SubnetId": {"Fn::Select": [0, {"Fn::GetAZs": {"Ref": "AWS::Region"}}]}, "SecurityGroups": [{"Fn::GetAtt": ["MyEFSSecurityGroup", "GroupId"]}]}}, "MyMountTargetB": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "MyEFSFileSystem"}, "SubnetId": {"Fn::Select": [1, {"Fn::GetAZs": {"Ref": "AWS::Region"}}]}, "SecurityGroups": [{"Fn::GetAtt": ["MyEFSSecurityGroup", "GroupId"]}]}}, "MyEFSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow NFS access to EFS", "VpcId": "vpc-12345678", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 2049, "ToPort": 2049, "CidrIp": "0.0.0.0/0"}]}}, "MyInstanceProfile": {"Type": "AWS::IAM::InstanceProfile", "Properties": {"Roles": [{"Ref": "MyRole"}]}}, "MyRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "EFSAccessPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["elasticfilesystem:*", "ec2:DescribeNetworkInterfaces", "ec2:DescribeInstances", "ec2:DescribeVolumes"], "Resource": "*"}]}}]}}, "MyEFSClientInstance": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t2.micro", "ImageId": "ami-0abcdef1234567890", "KeyName": "your-key-pair", "SecurityGroupIds": [{"Fn::GetAtt": ["MyEFSSecurityGroup", "GroupId"]}], "IamInstanceProfile": {"Ref": "MyInstanceProfile"}, "UserData": {"Fn::Base64": {"Fn::Sub": ["#!/bin/bash\nsudo yum install -y amazon-efs-utils\nsudo mkdir /efs\nsudo mount -t efs ${FileSystemId}:/ /efs", {"FileSystemId": {"Ref": "MyEFSFileSystem"}}]}}}}}, "Outputs": {"FileSystemId": {"Description": "ID of the EFS file system", "Value": {"Ref": "MyEFSFileSystem"}}}}