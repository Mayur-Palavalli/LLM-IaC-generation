{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "DBClusterIdentifier": "aurora-cluster", "MasterUsername": "admin", "MasterUserPassword": {"Fn::Join": ["", ["{{resolve:secretsmanager:DBMasterPassword:SecretString:password}}"]]}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "AuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "DBInstanceClass": "db.r5.large", "Engine": "aurora-mysql", "PubliclyAccessible": false}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora DB cluster", "SubnetIds": ["subnet-xxxxxxxx", "subnet-yyyyyyyy"]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for Aurora DB", "VpcId": {"Ref": "VpcId"}}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "dms-target-bucket"}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.r5.large", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "PreferredMaintenanceWindow": "sun:06:00-sun:14:00"}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for DMS", "VpcId": {"Ref": "VpcId"}}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Fn::Join": ["", ["{{resolve:secretsmanager:DBMasterPassword:SecretString:password}}"]]}, "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}, "ServiceAccessRoleArn": "arn:aws:iam::123456789012:role/dms-s3-access-role"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationInstanceArn": {"Ref": "DMSReplicationInstance"}, "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "TableMappings": "{\"rules\": [{\"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": {\"schema-name\": \"public\", \"table-name\": \"%\"}, \"rule-action\": \"include\"}]}", "ReplicationTaskSettings": "{\"TargetMetadata\": {\"TargetSchema\": \"\", \"SupportLobs\": true, \"FullLobMode\": false, \"LobChunkSize\": 1024, \"LimitedSizeLobMode\": true, \"LobMaxSize\": 32, \"InlineLobMaxSize\": 0, \"LoadMaxFileSize\": 0, \"ParallelLoadThreads\": 1, \"ParallelLoadBufferSize\": 1000000}}"}}}, "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID"}}}