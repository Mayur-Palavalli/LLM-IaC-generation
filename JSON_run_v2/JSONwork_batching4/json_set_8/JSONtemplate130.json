{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Template for a highly-available RDS DBInstance with a read replica", "Resources": {"PrimaryDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceIdentifier": "primary-db-instance", "AllocatedStorage": "100", "DBInstanceClass": "db.t3.micro", "Engine": "mysql", "MasterUsername": "admin", "MasterUserPassword": "{{resolve:ssm:/aws/reference/secretsmanager/dbmasterpassword}}", "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VPCSecurityGroups": [{"Fn::GetAtt": ["DBSecurityGroup", "GroupId"]}], "MultiAZ": true, "PubliclyAccessible": false}}, "ReadReplicaInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceIdentifier": "read-replica-instance", "SourceDBInstanceIdentifier": {"Ref": "PrimaryDBInstance"}, "DBInstanceClass": "db.t3.micro", "Engine": "mysql", "PubliclyAccessible": false}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet Group for RDS DB Instance", "SubnetIds": [{"Ref": "SubnetA"}, {"Ref": "SubnetB"}]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for RDS DB Instance", "VpcId": {"Ref": "VPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3306", "ToPort": "3306", "CidrIp": "0.0.0.0/0"}]}}}, "Parameters": {"VPC": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID for RDS DB Instance"}, "SubnetA": {"Type": "AWS::EC2::Subnet::Id", "Description": "Subnet ID for Availability Zone A"}, "SubnetB": {"Type": "AWS::EC2::Subnet::Id", "Description": "Subnet ID for Availability Zone B"}}, "Outputs": {"PrimaryDBInstanceEndpoint": {"Description": "Primary DB Instance Endpoint", "Value": {"Fn::GetAtt": ["PrimaryDBInstance", "Endpoint.Address"]}}, "ReadReplicaInstanceEndpoint": {"Description": "Read Replica Instance Endpoint", "Value": {"Fn::GetAtt": ["ReadReplicaInstance", "Endpoint.Address"]}}}}