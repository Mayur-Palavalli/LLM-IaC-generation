{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Template for an Auto-Scaled, Load-Balanced Sample Website with Security Group and Health Check.", "Resources": {"WebServerSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable access only from the Load Balancer", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "8888", "ToPort": "8888", "SourceSecurityGroupId": {"Ref": "LoadBalancerSecurityGroup"}}]}}, "LoadBalancerSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable access to the Load Balancer", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "80", "ToPort": "80", "CidrIp": "0.0.0.0/0"}]}}, "ApplicationLoadBalancer": {"Type": "AWS::ElasticLoadBalancingV2::LoadBalancer", "Properties": {"Subnets": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}], "SecurityGroups": [{"Ref": "LoadBalancerSecurityGroup"}]}}, "TargetGroup": {"Type": "AWS::ElasticLoadBalancingV2::TargetGroup", "Properties": {"Port": 8888, "Protocol": "HTTP", "VpcId": {"Ref": "VpcId"}, "HealthCheckProtocol": "HTTP", "HealthCheckPort": "8888", "HealthCheckPath": "/", "Matcher": {"HttpCode": "200"}}}, "Listener": {"Type": "AWS::ElasticLoadBalancingV2::Listener", "Properties": {"DefaultActions": [{"Type": "forward", "TargetGroupArn": {"Ref": "TargetGroup"}}], "LoadBalancerArn": {"Ref": "ApplicationLoadBalancer"}, "Port": 80, "Protocol": "HTTP"}}, "LaunchConfiguration": {"Type": "AWS::AutoScaling::LaunchConfiguration", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t2.micro", "SecurityGroups": [{"Ref": "WebServerSecurityGroup"}], "UserData": {"Fn::Base64": {"Fn::Sub": "#!/bin/bash -xe\n\n# Install web server\nyum install -y httpd\n\n# Launch web server\nservice httpd start\n\n# Notify the load balancer\n/opt/aws/bin/cfn-signal -e $? --stack ${AWS::StackName} --resource AutoScalingGroup --region ${AWS::Region}"}}}}, "AutoScalingGroup": {"Type": "AWS::AutoScaling::AutoScalingGroup", "Properties": {"VPCZoneIdentifier": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}], "LaunchConfigurationName": {"Ref": "LaunchConfiguration"}, "MinSize": "1", "MaxSize": "3", "DesiredCapacity": "2", "TargetGroupARNs": [{"Ref": "TargetGroup"}], "HealthCheckType": "EC2"}}}, "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC Id"}, "Subnet1": {"Type": "AWS::EC2::Subnet::Id", "Description": "Subnet1 Id"}, "Subnet2": {"Type": "AWS::EC2::Subnet::Id", "Description": "Subnet2 Id"}}}