{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "MyChannel", "ChannelStorage": {"ServiceManagedS3": {}}}}, "MyDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "MyDatastore", "DatastoreStorage": {"ServiceManagedS3": {}}}}, "MyPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "MyPipeline", "PipelineActivities": [{"Channel": {"ChannelName": {"Ref": "MyChannel"}, "Name": "MyChannelActivity", "Next": "MySQLActivity"}}, {"Lambda": {"BatchSize": 1, "LambdaName": "MyLambdaFunction", "Name": "MySQLActivity", "Next": "MyDatastoreActivity"}}, {"Datastore": {"DatastoreName": {"Ref": "MyDatastore"}, "Name": "MyDatastoreActivity"}}]}}, "MyDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "MyDataset", "Actions": [{"ActionName": "SQLAction", "SqlQuery": {"Selectors": ["MyDatastore"], "Where": ["time"], "From": [{"ResourceType": "DataStore", "Name": {"Ref": "MyDatastore"}}]}}]}}}}