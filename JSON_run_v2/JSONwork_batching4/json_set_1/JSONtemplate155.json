{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create an AD Connector, seamless domain join resources, domain members security group, and a DHCP options set.", "Parameters": {"OnPremDomainName": {"Type": "String", "Description": "On-premises domain name"}, "ADConnectorName": {"Type": "String", "Description": "Name for the AD Connector"}, "DomainControllers": {"Type": "List<String>", "Description": "List of IP addresses of the on-premises domain controllers"}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "The subnets for the AD Connector"}, "VPCId": {"Type": "AWS::EC2::VPC::Id", "Description": "The VPC ID for the AD Connector"}, "EC2DomainJoinSSMRole": {"Type": "String", "Description": "The IAM role for SSM to join instances to domain"}, "DNSIpAddresses": {"Type": "List<String>", "Description": "List of DNS server IP addresses associated with your VPC"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "ADConnectorName"}, "Password": {"Ref": "OnPremPassword"}, "Description": "AD Connector for on-premises domain", "Size": "Small", "VpcSettings": {"VpcId": {"Ref": "VPCId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "SeamlessDomainJoinRole": {"Type": "AWS::IAM::Role", "Properties": {"RoleName": "EC2SeamlessDomainJoinRole", "AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "DomainJoinPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["ds:DescribeDirectories", "ds:CreateComputer", "ds:DeleteComputer", "ds:JoinInstance"], "Resource": "*"}]}}]}}, "DomainMemberSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupName": "DomainMembers", "GroupDescription": "Security group for domain member instances", "VpcId": {"Ref": "VPCId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "FromPort": "-1", "ToPort": "-1", "CidrIp": "0.0.0.0/0"}]}}, "DHCPOptionSet": {"Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "OnPremDomainName"}, "DomainNameServers": {"Ref": "DNSIpAddresses"}}}, "DHCPOptionSetAssociation": {"Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"VpcId": {"Ref": "VPCId"}, "DhcpOptionsId": {"Ref": "DHCPOptionSet"}}}}, "Outputs": {"ADConnectorId": {"Description": "The ID of the AD Connector", "Value": {"Ref": "ADConnector"}}, "SeamlessDomainJoinRoleArn": {"Description": "The ARN of the Seamless Domain Join Role", "Value": {"Fn::GetAtt": ["SeamlessDomainJoinRole", "Arn"]}}, "DomainMemberSecurityGroupId": {"Description": "The ID of the Domain Member Security Group", "Value": {"Ref": "DomainMemberSecurityGroup"}}, "DHCPOptionSetId": {"Description": "The ID of the DHCP Option Set", "Value": {"Ref": "DHCPOptionSet"}}}}