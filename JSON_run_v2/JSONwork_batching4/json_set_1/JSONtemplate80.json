{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"EKSRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "eks.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "eks-cluster-policy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["ec2:Describe*", "ecr:GetDownloadUrlForLayer", "ecr:BatchGetImage", "ecr:BatchCheckLayerAvailability", "autoscaling:DescribeAutoScalingGroups", "autoscaling:DescribeLaunchConfigurations", "autoscaling:DescribeTags", "elasticloadbalancing:DescribeLoadBalancers", "elasticloadbalancing:DescribeLoadBalancerAttributes", "elasticloadbalancing:DescribeListeners", "elasticloadbalancing:DescribeRules", "elasticloadbalancing:DescribeTargetGroups", "elasticloadbalancing:DescribeTargetGroupAttributes", "elasticloadbalancing:DescribeTargetHealth"], "Resource": "*"}]}}]}}, "EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": "MyEKSCluster", "RoleArn": {"Fn::GetAtt": ["EKSRole", "Arn"]}, "ResourcesVpcConfig": {"SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}], "SecurityGroupIds": [{"Ref": "EKSClusterSecurityGroup"}]}}}, "EKSClusterSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "EKS Cluster security group", "VpcId": {"Ref": "VPC"}}}, "VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": "true", "EnableDnsHostnames": "true", "Tags": [{"Key": "Name", "Value": "eks-vpc"}]}}, "Subnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": ["0", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "Name", "Value": "eks-subnet-1"}]}}, "Subnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.2.0/24", "AvailabilityZone": {"Fn::Select": ["1", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "Name", "Value": "eks-subnet-2"}]}}}, "Outputs": {"EKSClusterName": {"Description": "Name of the EKS Cluster", "Value": {"Ref": "EKSCluster"}, "Export": {"Name": {"Fn::Sub": "${AWS::StackName}-EKSClusterName"}}}}}