{"AWSTemplateFormatVersion": "2010-09-09", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID"}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "List of Subnet IDs"}, "DnsIpAddresses": {"Type": "List<AWS::EC2::PrivateIpAddress>", "Description": "List of DNS IP Addresses from the on-premises AD"}, "DomainName": {"Type": "String", "Description": "The fully qualified name of the on-premises domain"}, "AdConnectorName": {"Type": "String", "Description": "The name of the AD Connector"}, "CustomerDnsIps": {"Type": "CommaDelimitedList", "Description": "Comma-separated list of DNS IP addresses for the on-premises domain"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "AdConnectorName"}, "Password": "ReplaceThisWithSecurePassword", "Description": "AD Connector for on-premises domain", "ShortName": {"Ref": "DomainName"}, "VpcSettings": {"SubnetIds": {"Ref": "SubnetIds"}, "VpcId": {"Ref": "VpcId"}}}}, "DomainMembersSecurityGroup": {"Condition": "CreateDomainMembersSecurityGroup", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for domain member communication", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "SourceSecurityGroupId": {"Ref": "DomainMembersSecurityGroup"}}]}}, "DHCPOptionsSet": {"Condition": "CreateDHCPOptionSet", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "DomainName"}, "DomainNameServers": {"Ref": "DnsIpAddresses"}}}, "DHCPOptionsAssociation": {"Condition": "CreateDHCPOptionSet", "Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"DhcpOptionsId": {"Ref": "DHCPOptionsSet"}, "VpcId": {"Ref": "VpcId"}}}}, "Conditions": {"CreateDomainMembersSecurityGroup": {"Fn::Equals": [{"Ref": "CreateDomainMembersSecurityGroup"}, "true"]}, "CreateDHCPOptionSet": {"Fn::Equals": [{"Ref": "CreateDHCPOptionSet"}, "true"]}}, "Metadata": {"AWS::CloudFormation::Interface": {"ParameterGroups": [{"Label": {"default": "Network Configuration"}, "Parameters": ["VpcId", "SubnetIds", "DnsIpAddresses", "DomainName"]}, {"Label": {"default": "AD Connector Configuration"}, "Parameters": ["AdConnectorName", "CustomerDnsIps"]}], "ParameterLabels": {"VpcId": {"default": "VPC ID"}, "SubnetIds": {"default": "Subnet IDs"}, "DnsIpAddresses": {"default": "DNS IP Addresses"}, "DomainName": {"default": "Domain Name"}, "AdConnectorName": {"default": "AD Connector Name"}, "CustomerDnsIps": {"default": "Customer DNS IPs"}}}}}