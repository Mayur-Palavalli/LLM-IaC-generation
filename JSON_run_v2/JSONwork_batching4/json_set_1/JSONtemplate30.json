{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"DateMacro": {"Type": "AWS::Lambda::Function", "Properties": {"Handler": "index.handler", "Role": {"Fn::GetAtt": ["LambdaExecutionRole", "Arn"]}, "Code": {"ZipFile": {"Fn::Sub": ["import json\n", "from datetime import datetime, timedelta\n", "def handler(event, context):\n", "operation = event.get('operation')\n", "if operation == 'CurrentDate':\n", "return { 'date': datetime.utcnow().isoformat() }\n", "elif operation == 'DateAdd':\n", "delta = timedelta(days=event.get('days', 0), seconds=event.get('seconds', 0),", "minutes=event.get('minutes', 0), hours=event.get('hours', 0))\n", "return { 'date': (datetime.utcnow() + delta).isoformat() }\n", "else:\n", "return { 'error': 'Unsupported operation' }\n"]}}, "Runtime": "python3.8", "Timeout": 60}}, "LambdaExecutionRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "lambda.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "root", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["logs:CreateLogGroup", "logs:CreateLogStream", "logs:PutLogEvents"], "Resource": "*"}]}}]}}}, "Outputs": {"DateMacroFunctionArn": {"Description": "ARN of the DateMacro Lambda function", "Value": {"Fn::GetAtt": ["DateMacro", "Arn"]}}}}