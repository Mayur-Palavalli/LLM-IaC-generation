{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create a secure S3 bucket with server-side encryption, replicas bucket, and access logs bucket. Public access is disabled and secure transport is enforced.", "Resources": {"SecureBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "secure-bucket", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "LoggingConfiguration": {"DestinationBucketName": {"Ref": "AccessLogBucket"}, "LogFilePrefix": "secure-bucket-access-logs/"}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "BlockPublicPolicy": true, "IgnorePublicAcls": true, "RestrictPublicBuckets": true}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "ReplicasBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "replicas-bucket", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "BlockPublicPolicy": true, "IgnorePublicAcls": true, "RestrictPublicBuckets": true}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "AccessLogBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "access-log-bucket", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "BlockPublicPolicy": true, "IgnorePublicAcls": true, "RestrictPublicBuckets": true}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "SecureBucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Properties": {"Bucket": {"Ref": "SecureBucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Deny", "Principal": "*", "Action": "s3:*", "Resource": [{"Fn::Sub": "arn:aws:s3:::${SecureBucket}/*"}, {"Fn::Sub": "arn:aws:s3:::${SecureBucket}"}], "Condition": {"Bool": {"aws:SecureTransport": "false"}}}]}}}, "ReplicasBucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Properties": {"Bucket": {"Ref": "ReplicasBucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Deny", "Principal": "*", "Action": "s3:*", "Resource": [{"Fn::Sub": "arn:aws:s3:::${ReplicasBucket}/*"}, {"Fn::Sub": "arn:aws:s3:::${ReplicasBucket}"}], "Condition": {"Bool": {"aws:SecureTransport": "false"}}}]}}}, "AccessLogBucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Properties": {"Bucket": {"Ref": "AccessLogBucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "logging.s3.amazonaws.com"}, "Action": "s3:PutObject", "Resource": {"Fn::Sub": "arn:aws:s3:::${AccessLogBucket}/secure-bucket-access-logs/*"}}]}}}}}