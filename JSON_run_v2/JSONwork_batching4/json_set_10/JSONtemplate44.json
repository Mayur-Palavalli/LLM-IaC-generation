{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "{{resolve:ssm:MasterUsername}}", "MasterUserPassword": "{{resolve:ssm-secure:MasterUserPassword}}", "DBClusterIdentifier": "aurora-cluster", "EngineVersion": "5.7.mysql_aurora.2.12.0", "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "AuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "DBInstanceClass": "db.t3.medium", "Engine": "aurora-mysql"}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for Aurora RDS instance", "VpcId": {"Ref": "VpcId"}}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora RDS instance", "SubnetIds": {"Ref": "SubnetIds"}}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora-mysql", "Username": "{{resolve:ssm:MasterUsername}}", "Password": "{{resolve:ssm-secure:MasterUserPassword}}", "DatabaseName": "mydatabase", "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3"}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t3.medium", "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "ReplicationInstanceIdentifier": "dms-replication-instance", "AllocatedStorage": 100}}, "DMSReplicationTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationTaskIdentifier": "dms-task", "SourceEndpointArn": {"Fn::GetAtt": ["DMSSourceEndpoint", "ExternalId"]}, "TargetEndpointArn": {"Fn::GetAtt": ["DMSTargetEndpoint", "ExternalId"]}, "MigrationType": "full-load-and-cdc", "TableMappings": "{ \"rules\": [{ \"rule-type\": \"include\", \"object-locator\": { \"schema-name\": \"%\", \"table-name\": \"%\" }, \"rule-action\": \"include\" }] }", "ReplicationTaskSettings": "{}", "ReplicationInstanceArn": {"Ref": "DMSReplicationInstance"}}}}, "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "ID of the VPC"}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "List of Subnet IDs"}}}