{"AWSTemplateFormatVersion": "2010-09-09", "Description": "CloudFormation template to create an AD Connector with options for seamless domain join resources, security group, and DHCP Option Set.", "Parameters": {"DirectoryName": {"Type": "String", "Description": "The fully qualified name (FQDN) of the on-premises directory."}, "DomainDNSIP1": {"Type": "String", "Description": "The IP address of the primary DNS server for the on-premises directory."}, "DomainDNSIP2": {"Type": "String", "Description": "The IP address of the secondary DNS server for the on-premises directory."}, "SubnetId1": {"Type": "String", "Description": "The ID of the first subnet in your VPC in which to create the directory."}, "SubnetId2": {"Type": "String", "Description": "The ID of the second subnet in your VPC in which to create the directory."}, "CreateDomainJoin": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Whether to create seamless domain join resources for Windows & Linux EC2 instances."}, "CreateSecurityGroup": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Whether to create a domain members security group that allows all PrivateIP communications inbound."}, "CreateDHCPOptionSet": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Whether to create a DHCPOptionSet pointing to Domain DNS servers."}, "VpcId": {"Type": "String", "Description": "The ID of the VPC to associate the resources with."}}, "Resources": {"SimpleAD": {"Type": "AWS::DirectoryService::SimpleAD", "Properties": {"Name": {"Ref": "DirectoryName"}, "Password": {"Ref": "Password"}, "Size": "Small", "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": [{"Ref": "SubnetId1"}, {"Ref": "SubnetId2"}]}}}, "DomainMembersSecurityGroup": {"Condition": "CreateSecurityGroupCondition", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for domain members allowing all PrivateIP communications inbound.", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/8"}]}}, "DHCPOptionSet": {"Condition": "CreateDHCPOptionSetCondition", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainNameServers": [{"Ref": "DomainDNSIP1"}, {"Ref": "DomainDNSIP2"}], "DomainName": {"Ref": "DirectoryName"}}}, "DHCPOptionSetAssociation": {"Condition": "CreateDHCPOptionSetCondition", "Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"DhcpOptionsId": {"Ref": "DHCPOptionSet"}, "VpcId": {"Ref": "VpcId"}}}}, "Conditions": {"CreateSecurityGroupCondition": {"Fn::Equals": [{"Ref": "CreateSecurityGroup"}, "Yes"]}, "CreateDHCPOptionSetCondition": {"Fn::Equals": [{"Ref": "CreateDHCPOptionSet"}, "Yes"]}}}