{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for creating an AD Connector and associated resources.", "Parameters": {"DirectoryName": {"Type": "String", "Description": "The fully qualified name of your on-premises directory."}, "ShortName": {"Type": "String", "Description": "The NetBIOS name of your on-premises directory."}, "VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The VPC ID where the AD Connector will be created."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "List of subnet IDs for the AD Connector."}, "DNSIpAddresses": {"Type": "List<String>", "Description": "List of IP addresses of the DNS servers for the on-premises directory."}, "DirectoryPassword": {"Type": "String", "Description": "The password for the Directory service account.", "NoEcho": true}, "CustomerUserName": {"Type": "String", "Description": "The username for the customer account."}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::SimpleAD", "Properties": {"Name": {"Ref": "DirectoryName"}, "ShortName": {"Ref": "ShortName"}, "Password": {"Ref": "DirectoryPassword"}, "Size": "Small", "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "SeamlessDomainJoinRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Path": "/", "Policies": [{"PolicyName": "SeamlessDomainJoinPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": "ds:JoinDomain", "Resource": "*"}]}}]}}, "DomainMembersSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for domain members", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "0.0.0.0/0"}], "SecurityGroupEgress": [{"IpProtocol": "-1", "CidrIp": "0.0.0.0/0"}]}}, "DHCPOptionSet": {"Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainNameServers": {"Ref": "DNSIpAddresses"}}, "Condition": "CreateDHCPOptionSet"}, "DHCPOptionSetAssociation": {"Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"DhcpOptionsId": {"Ref": "DHCPOptionSet"}, "VpcId": {"Ref": "VpcId"}}, "Condition": "CreateDHCPOptionSet"}}, "Conditions": {"CreateDHCPOptionSet": {"Fn::Equals": ["true", "true"]}}}