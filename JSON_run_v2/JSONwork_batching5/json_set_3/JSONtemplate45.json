{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "DBMasterPassword"}, "DBClusterParameterGroupName": "default.aurora-mysql5.7", "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "AuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "DBInstanceClass": "db.t3.medium", "Engine": "aurora-mysql"}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Database Security Group", "VpcId": {"Ref": "VPC"}}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "DB Subnet Group", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16"}}, "Subnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24"}}, "Subnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.2.0/24"}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "DMS Security Group", "VpcId": {"Ref": "VPC"}}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t3.medium", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSReplicationSubnetGroup"}}}, "DMSReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "DMS Subnet Group", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Ref": "SourceEndpointPassword"}, "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "yourdbname"}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "BucketName": {"Ref": "S3Bucket"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationTaskIdentifier": "migrate-aurora-to-s3", "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "TableMappings": "your-table-mappings-json"}}, "S3Bucket": {"Type": "AWS::S3::Bucket"}}, "Parameters": {"DBMasterPassword": {"Type": "String", "NoEcho": true}, "SourceEndpointPassword": {"Type": "String", "NoEcho": true}, "S3BucketName": {"Type": "String"}}}