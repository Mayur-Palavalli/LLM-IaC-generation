{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create an Amazon EKS cluster on EC2.", "Resources": {"EKSClusterRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "eks.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"], "RoleName": "eksClusterRole"}}, "EKSEC2Role": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy", "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy", "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"], "RoleName": "eksEC2Role"}}, "NodeInstanceProfile": {"Type": "AWS::IAM::InstanceProfile", "Properties": {"Roles": [{"Ref": "EKSEC2Role"}], "InstanceProfileName": "eksNodeInstanceProfile"}}, "EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": "eksCluster", "ResourcesVpcConfig": {"SubnetIds": ["subnet-0bb1c79de3EXAMPLE"], "SecurityGroupIds": ["sg-6979fe18"]}, "RoleArn": {"Fn::GetAtt": ["EKSClusterRole", "Arn"]}}}, "NodeGroup": {"Type": "AWS::EKS::Nodegroup", "Properties": {"ClusterName": {"Ref": "EKSCluster"}, "NodegroupName": "eksNodeGroup", "ScalingConfig": {"DesiredSize": 3, "MaxSize": 5, "MinSize": 1}, "Subnets": ["subnet-0bb1c79de3EXAMPLE"], "InstanceTypes": ["t3.medium"], "AmiType": "AL2_x86_64", "NodeRole": {"Fn::GetAtt": ["EKSEC2Role", "Arn"]}}}}}