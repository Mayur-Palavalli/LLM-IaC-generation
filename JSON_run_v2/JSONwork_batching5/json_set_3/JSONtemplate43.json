{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true, "Tags": [{"Key": "Name", "Value": "my-vpc"}]}}, "MySubnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "Name", "Value": "my-subnet"}]}}, "MyDBClusterSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora RDS", "SubnetIds": [{"Ref": "MySubnet"}], "Tags": [{"Key": "Name", "Value": "my-db-subnet-group"}]}}, "MyDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": {"Fn::Sub": "{{resolve:secretsmanager:MasterUserPassword}}"}, "DBSubnetGroupName": {"Ref": "MyDBClusterSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "MyVPCSecurityGroup"}]}}, "MyDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "MyDBCluster"}, "DBInstanceClass": "db.r5.large"}}, "MyVPCSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for Aurora RDS", "VpcId": {"Ref": "MyVPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "MyS3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {}}, "MyDMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.r5.large", "ReplicationInstanceIdentifier": "my-dms-replication-instance", "VpcSecurityGroupIds": [{"Ref": "MyVPCSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "MyDMSReplicationSubnetGroup"}}}, "MyDMSReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupIdentifier": "my-replication-subnet-group", "ReplicationSubnetGroupDescription": "Subnet group for DMS replication instance", "SubnetIds": [{"Ref": "MySubnet"}]}}, "MySourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Fn::Sub": "{{resolve:secretsmanager:SourceEndpointPassword}}"}, "ServerName": {"Fn::GetAtt": ["MyDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "MyTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "MyS3Bucket"}}}}, "MyDMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationInstanceArn": {"Ref": "MyDMSReplicationInstance"}, "SourceEndpointArn": {"Ref": "MySourceEndpoint"}, "TargetEndpointArn": {"Ref": "MyTargetEndpoint"}, "TableMappings": "{ \"rules\": [{ \"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": { \"schema-name\": \"%\", \"table-name\": \"%\" }, \"rule-action\": \"include\" }]}"}}}}