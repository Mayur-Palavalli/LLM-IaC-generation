{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"GreengrassServiceRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "greengrass.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "GreengrassRolePolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["iot:*", "greengrass:*", "logs:*", "lambda:*"], "Resource": "*"}]}}]}}, "GreengrassGroup": {"Type": "AWS::Greengrass::Group", "Properties": {"Name": "MyGreengrassGroup", "RoleArn": {"Fn::GetAtt": ["GreengrassServiceRole", "Arn"]}}}, "GreengrassCoreDefinition": {"Type": "AWS::Greengrass::CoreDefinition", "Properties": {"Name": "MyGreengrassCoreDefinition", "InitialVersion": {"Cores": [{"Id": "GreengrassCore", "CertificateArn": {"Ref": "GreengrassCoreCertificateArn"}, "ThingArn": {"Ref": "GreengrassCoreThingArn"}}]}}}, "GreengrassFunctionDefinition": {"Type": "AWS::Greengrass::FunctionDefinition", "Properties": {"Name": "MyGreengrassFunctionDefinition", "InitialVersion": {"Functions": [{"Id": "GreengrassFunction", "FunctionArn": {"Ref": "GreengrassFunctionArn"}, "FunctionConfiguration": {"EncodingType": "json", "Environment": {"Variables": {"ExampleVariable": "ExampleValue"}}}}]}}}, "GreengrassDeviceDefinition": {"Type": "AWS::Greengrass::DeviceDefinition", "Properties": {"Name": "MyGreengrassDeviceDefinition", "InitialVersion": {"Devices": [{"Id": "GreengrassDevice", "CertificateArn": {"Ref": "GreengrassDeviceCertificateArn"}, "ThingArn": {"Ref": "GreengrassDeviceThingArn"}}]}}}, "GreengrassSubscriptionDefinition": {"Type": "AWS::Greengrass::SubscriptionDefinition", "Properties": {"Name": "MyGreengrassSubscriptionDefinition", "InitialVersion": {"Subscriptions": [{"Id": "GreengrassSubscription", "Source": {"Ref": "GreengrassFunctionArn"}, "Subject": "example/topic", "Target": {"Ref": "GreengrassFunctionArn"}}]}}}}, "Parameters": {"GreengrassCoreCertificateArn": {"Type": "String", "Description": "Certificate ARN for the Greengrass core."}, "GreengrassCoreThingArn": {"Type": "String", "Description": "Thing ARN for the Greengrass core."}, "GreengrassFunctionArn": {"Type": "String", "Description": "Lambda function ARN for the Greengrass function."}, "GreengrassDeviceCertificateArn": {"Type": "String", "Description": "Certificate ARN for the Greengrass device."}, "GreengrassDeviceThingArn": {"Type": "String", "Description": "Thing ARN for the Greengrass device."}}}