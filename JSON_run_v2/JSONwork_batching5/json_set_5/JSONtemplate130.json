{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create a highly-available RDS DBInstance with a read replica", "Resources": {"MyDBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for RDS DB instance", "SubnetIds": ["subnet-12345678", "subnet-87654321"]}}, "MyDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"AllocatedStorage": "20", "DBInstanceClass": "db.t3.micro", "Engine": "mysql", "EngineVersion": "8.0.32", "MasterUsername": "{{resolve:ssm:/database/admin/username}}", "MasterUserPassword": "{{resolve:ssm-secure:/database/admin/password}}", "DBSubnetGroupName": {"Ref": "MyDBSubnetGroup"}, "VPCSecurityGroups": [{"Ref": "MyDBSecurityGroup"}], "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}, "BackupRetentionPeriod": 7, "MultiAZ": true}}, "MyDBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for RDS DB instance", "VpcId": "vpc-12345678", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "MyReadReplica": {"Type": "AWS::RDS::DBInstance", "Properties": {"SourceDBInstanceIdentifier": {"Ref": "MyDBInstance"}, "DBInstanceClass": "db.t3.micro", "AvailabilityZone": {"Fn::Select": [1, {"Fn::GetAZs": ""}]}}}}, "Parameters": {"DBUsername": {"Type": "String", "Description": "The database admin account username"}, "DBPassword": {"Type": "String", "Description": "The database admin account password", "NoEcho": true}}, "Outputs": {"DBInstanceEndpoint": {"Description": "The endpoint for the RDS DB instance", "Value": {"Fn::GetAtt": ["MyDBInstance", "Endpoint.Address"]}}, "ReadReplicaEndpoint": {"Description": "The endpoint for the RDS Read Replica", "Value": {"Fn::GetAtt": ["MyReadReplica", "Endpoint.Address"]}}}}