{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"SecureBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "secure-bucket", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "LoggingConfiguration": {"DestinationBucketName": {"Ref": "AccessLogBucket"}, "LogFilePrefix": "secure-bucket-logs/"}, "ReplicationConfiguration": {"Role": {"Fn::GetAtt": ["ReplicationRole", "Arn"]}, "Rules": [{"Status": "Enabled", "Destination": {"Bucket": {"Fn::GetAtt": ["ReplicaBucket", "Arn"]}, "EncryptionConfiguration": {"ReplicaKmsKeyID": "arn:aws:kms:your-region:your-account-id:key/your-key-id"}}, "Prefix": ""}]}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "ReplicaBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "replica-bucket", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "AccessLogBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "access-log-bucket", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "ReplicationRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "s3.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "ReplicationPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["s3:GetReplicationConfiguration", "s3:ListBucket"], "Resource": "arn:aws:s3:::secure-bucket"}, {"Effect": "Allow", "Action": ["s3:GetObjectVersion", "s3:GetObjectVersionAcl"], "Resource": "arn:aws:s3:::secure-bucket/*"}, {"Effect": "Allow", "Action": ["s3:ReplicateObject", "s3:ReplicateDelete", "s3:ReplicateTags", "s3:GetObjectVersionTagging"], "Resource": "arn:aws:s3:::replica-bucket/*"}]}}]}}, "SecureBucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Properties": {"Bucket": {"Ref": "SecureBucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Deny", "Principal": "*", "Action": "s3:*", "Resource": ["arn:aws:s3:::secure-bucket/*", "arn:aws:s3:::secure-bucket"], "Condition": {"Bool": {"aws:SecureTransport": "false"}}}]}}}}}