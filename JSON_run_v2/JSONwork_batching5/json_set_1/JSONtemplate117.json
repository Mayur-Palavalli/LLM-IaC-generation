{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "MyIoTChannel", "RetentionPeriod": {"NumberOfDays": 7, "Unlimited": false}, "Tags": [{"Key": "Environment", "Value": "Production"}]}}, "MyDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "MyIoTDatastore", "RetentionPeriod": {"NumberOfDays": 30, "Unlimited": false}, "Tags": [{"Key": "Environment", "Value": "Production"}]}}, "MyPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "MyIoTPipeline", "PipelineActivities": [{"Channel": {"Name": "ChannelActivity", "ChannelName": {"Ref": "MyChannel"}, "Next": "SQLActivity"}}, {"Lambda": {"Name": "SQLActivity", "LambdaName": "MyLambdaFunction", "BatchSize": 100, "Next": "DatastoreActivity"}}, {"Datastore": {"Name": "DatastoreActivity", "DatastoreName": {"Ref": "MyDatastore"}}}]}}, "MyDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "MyIoTDataset", "Actions": [{"ActionName": "SQLQuery", "QueryAction": {"SqlQuery": "SELECT * FROM MyIoTDataset", "Filters": [{"DeltaTime": {"TimeExpression": "2021-01-01T00:00:00Z", "OffsetSeconds": 3600}}]}}], "Triggers": [{"Schedule": {"Expression": "rate(1 hour)"}}], "RetentionPeriod": {"NumberOfDays": 7, "Unlimited": false}, "Tags": [{"Key": "Environment", "Value": "Production"}]}}}, "Outputs": {"ChannelName": {"Description": "Name of the IoT Analytics Channel", "Value": {"Ref": "MyChannel"}}, "DatastoreName": {"Description": "Name of the IoT Analytics Datastore", "Value": {"Ref": "MyDatastore"}}, "PipelineName": {"Description": "Name of the IoT Analytics Pipeline", "Value": {"Ref": "MyPipeline"}}, "DatasetName": {"Description": "Name of the IoT Analytics Dataset", "Value": {"Ref": "MyDataset"}}}}