{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": "true", "EnableDnsHostnames": "true"}}, "MySubnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24"}}, "MyDBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora RDS instance", "SubnetIds": [{"Ref": "MySubnet"}]}}, "MyCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": "password", "DBSubnetGroupName": {"Ref": "MyDBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "MySecurityGroup"}]}}, "MyDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "MyCluster"}, "DBInstanceClass": "db.t3.medium"}}, "MySecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow access to Aurora RDS and DMS", "VpcId": {"Ref": "MyVPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3306", "ToPort": "3306", "CidrIp": "0.0.0.0/0"}, {"IpProtocol": "tcp", "FromPort": "8182", "ToPort": "8182", "CidrIp": "0.0.0.0/0"}]}}, "MyS3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "my-dms-target-bucket"}}, "MyDMSInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.c5.large", "AllocatedStorage": 100, "VpcSecurityGroupIds": [{"Ref": "MySecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "MyReplicationSubnetGroup"}}}, "MyReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnet group for DMS instance", "SubnetIds": [{"Ref": "MySubnet"}]}}, "MySourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": "password", "ServerName": "my-aurora.cluster-XYZ.us-east-1.rds.amazonaws.com", "Port": 3306, "DatabaseName": "mydatabase"}}, "MyTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target", "EndpointType": "target", "EngineName": "s3", "BucketFolder": "dmsfolder", "BucketName": {"Ref": "MyS3Bucket"}}}, "MyDMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationInstanceArn": {"Ref": "MyDMSInstance"}, "SourceEndpointArn": {"Ref": "MySourceEndpoint"}, "TargetEndpointArn": {"Ref": "MyTargetEndpoint"}, "TableMappings": "{\"rules\": [{\"rule-type\": \"selection\",\"rule-id\": \"1\",\"rule-name\": \"1\",\"object-locator\": {\"schema-name\": \"%\",\"table-name\": \"%\"},\"rule-action\": \"include\"}]}", "ReplicationTaskSettings": "{\"TargetMetadata\": {\"SupportLobs\": true,\"FullLobMode\": true,\"LobChunkSize\": 64,\"LimitedSizeLobMode\": false,\"LobMaxSize\": 0,\"EnableTransactionIntegrity\": false,\"TaskRecoveryTableEnabled\": false}}"}}}}