{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Sample Template EKS Cluster on EC2.", "Resources": {"EKSClusterRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "eks.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"]}}, "EKSMasterRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy", "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy", "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"]}}, "EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": "eks-sample-cluster", "RoleArn": {"Fn::GetAtt": ["EKSClusterRole", "Arn"]}, "ResourcesVpcConfig": {"SecurityGroupIds": [{"Ref": "EKSSecurityGroup"}], "SubnetIds": [{"Ref": "EKSSubnet1"}, {"Ref": "EKSSubnet2"}]}}}, "EKSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "EKS Security Group", "VpcId": {"Ref": "VPC"}}}, "EKSSubnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": ["0", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "Name", "Value": "EKSSubnet1"}]}}, "EKSSubnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.2.0/24", "AvailabilityZone": {"Fn::Select": ["1", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "Name", "Value": "EKSSubnet2"}]}}, "VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": "true", "EnableDnsHostnames": "true", "Tags": [{"Key": "Name", "Value": "EKS-VPC"}]}}, "EKSLaunchTemplate": {"Type": "AWS::EC2::LaunchTemplate", "Properties": {"LaunchTemplateName": "eks-launch-template", "LaunchTemplateData": {"InstanceType": "t3.medium", "IamInstanceProfile": {"Arn": {"Fn::GetAtt": ["EKSMasterRole", "Arn"]}}, "UserData": {"Fn::Base64": {"Fn::Join": ["", ["#!/bin/bash\n", "set -o xtrace\n"]]}}}}}}, "Outputs": {"EKSClusterName": {"Description": "Name of the EKS Cluster", "Value": {"Ref": "EKSCluster"}}}}