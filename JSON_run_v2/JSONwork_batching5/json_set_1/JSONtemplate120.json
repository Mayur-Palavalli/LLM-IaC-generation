{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "MyChannel", "ChannelStorage": {"ServiceManagedS3": {}}}}, "MyDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "MyDatastore", "DatastoreStorage": {"ServiceManagedS3": {}}}}, "MyPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "MyPipeline", "PipelineActivities": [{"Channel": {"Name": "ChannelActivity", "ChannelName": {"Ref": "MyChannel"}, "Next": "SqlActivity"}}, {"Sql": {"Name": "SqlActivity", "SqlQuery": "SELECT * FROM input", "Inputs": ["ChannelActivity"], "Next": "DatastoreActivity"}}, {"Datastore": {"Name": "DatastoreActivity", "DatastoreName": {"Ref": "MyDatastore"}}}]}}, "MyDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "MyDataset", "Actions": [{"ActionName": "SqlQueryAction", "SqlQueryDatasetAction": {"SqlQuery": "SELECT * FROM MyDatastore", "Filters": [], "OutputConfiguration": {"S3Configuration": {"Bucket": "my-output-bucket", "RoleArn": "arn:aws:iam::123456789012:role/MyRole"}}}}], "Triggers": [], "ContentDeliveryRules": []}}}, "Outputs": {"ChannelName": {"Value": {"Ref": "MyChannel"}}, "DatastoreName": {"Value": {"Ref": "MyDatastore"}}, "PipelineName": {"Value": {"Ref": "MyPipeline"}}, "DatasetName": {"Value": {"Ref": "MyDataset"}}}}