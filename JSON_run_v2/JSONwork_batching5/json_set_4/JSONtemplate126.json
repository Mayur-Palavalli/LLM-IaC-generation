{"AWSTemplateFormatVersion": "2010-09-09", "Description": "Highly-available RDS DBInstance with a read replica.", "Resources": {"MyDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"AllocatedStorage": "20", "DBInstanceClass": "db.t3.micro", "Engine": "mysql", "MasterUsername": "admin", "MasterUserPassword": {"Fn::Sub": "{{resolve:secretsmanager:DBPassword:SecretString:password}}"}, "DBSubnetGroupName": {"Ref": "MyDBSubnetGroup"}, "MultiAZ": "true", "VPCSecurityGroups": [{"Fn::GetAtt": ["MyDBSecurityGroup", "GroupId"]}]}}, "MyDBReadReplica": {"Type": "AWS::RDS::DBInstance", "Properties": {"SourceDBInstanceIdentifier": {"Ref": "MyDBInstance"}, "DBInstanceClass": "db.t3.micro", "DBSubnetGroupName": {"Ref": "MyDBSubnetGroup"}, "VPCSecurityGroups": [{"Fn::GetAtt": ["MyDBSecurityGroup", "GroupId"]}]}}, "MyDBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow database traffic", "VpcId": {"Ref": "MyVPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3306", "ToPort": "3306", "CidrIp": "0.0.0.0/0"}]}}, "MyDBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for RDS instance", "SubnetIds": [{"Ref": "SubnetA"}, {"Ref": "SubnetB"}]}}, "MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": "true", "EnableDnsHostnames": "true", "Tags": [{"Key": "Name", "Value": "MyVPC"}]}}, "SubnetA": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}}}, "SubnetB": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.2.0/24", "AvailabilityZone": {"Fn::Select": [1, {"Fn::GetAZs": ""}]}}}}}