{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "MyChannel", "ChannelStorage": {"ServiceManagedS3": {}}, "RetentionPeriod": {"Unlimited": true}}}, "MyDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "MyDatastore", "DatastoreStorage": {"ServiceManagedS3": {}}, "RetentionPeriod": {"Unlimited": true}}}, "MyPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "MyPipeline", "PipelineActivities": [{"Channel": {"Name": "ChannelActivity", "ChannelName": {"Ref": "MyChannel"}, "Next": "FilterActivity"}}, {"Filter": {"Name": "FilterActivity", "Filter": "attributes.isArray=TRUE", "Next": "SelectAttributesActivity"}}, {"SelectAttributes": {"Name": "SelectAttributesActivity", "Attributes": ["attribute1", "attribute2"], "Next": "DatastoreActivity"}}, {"Datastore": {"Name": "DatastoreActivity", "DatastoreName": {"Ref": "MyDatastore"}}}]}}, "MyDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "MyDataset", "Actions": [{"ActionName": "SqlQueryAction", "QueryAction": {"SqlQuery": "SELECT * FROM channel_data", "Filters": [{"DeltaTime": {"OffsetSeconds": 600, "TimeExpression": "timestamp"}}]}}], "ContentDeliveryRules": [{"EntryName": "S3DeliveryRule", "Destination": {"S3DestinationConfiguration": {"Bucket": "my-s3-bucket", "Key": "dataset_output/", "RoleArn": "arn:aws:iam::123456789012:role/my_s3_role"}}}]}}}}