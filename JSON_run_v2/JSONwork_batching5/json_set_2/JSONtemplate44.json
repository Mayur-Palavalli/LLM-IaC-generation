{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "AuroraMasterPassword"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "RDSSecurityGroup"}]}}, "AuroraMasterPassword": {"Type": "AWS::SSM::Parameter", "Properties": {"Type": "String", "Name": "AuroraMasterPassword", "Value": "SecurePassword"}}, "AuroraInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraCluster"}, "DBInstanceClass": "db.r5.large"}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora cluster", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "RDSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "RDS Security Group", "VpcId": {"Ref": "VPC"}}}, "DMSInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.r5.large", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnet group for DMS instance", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "DMS Security Group", "VpcId": {"Ref": "VPC"}}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "source-endpoint", "EndpointType": "source", "EngineName": "aurora-mysql", "Username": "admin", "Password": {"Ref": "AuroraMasterPassword"}, "ServerName": {"Fn::GetAtt": ["AuroraCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "auroradb"}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "target-endpoint", "EndpointType": "target", "EngineName": "s3"}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationInstanceArn": {"Ref": "DMSInstance"}, "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "TableMappings": "{ \"rules\": [ { \"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": { \"schema-name\": \"%\", \"table-name\": \"%\" }, \"rule-action\": \"include\" } ] }", "ReplicationTaskSettings": "{}", "ReplicationTaskIdentifier": "my-replication-task"}}, "VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": "true", "EnableDnsHostnames": "true"}}, "Subnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}}}, "Subnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.2.0/24", "AvailabilityZone": {"Fn::Select": [1, {"Fn::GetAZs": ""}]}}}}}