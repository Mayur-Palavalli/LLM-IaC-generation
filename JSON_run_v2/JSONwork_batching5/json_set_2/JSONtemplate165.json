{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for one Linux and three Windows EC2 instances joining Active Directory using 'AWS-JoinDirectoryServiceDomain' SSM document.", "Resources": {"LinuxEC2Instance": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t2.micro", "KeyName": "your-key-pair", "IamInstanceProfile": "EC2InstanceSSMRole", "Tags": [{"Key": "Name", "Value": "LinuxEC2Instance"}]}}, "WindowsEC2Instance1": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t2.micro", "KeyName": "your-key-pair", "IamInstanceProfile": "EC2InstanceSSMRole", "Tags": [{"Key": "Name", "Value": "WindowsEC2Instance1"}]}}, "WindowsEC2Instance2": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t2.micro", "KeyName": "your-key-pair", "IamInstanceProfile": "EC2InstanceSSMRole", "Tags": [{"Key": "Name", "Value": "WindowsEC2Instance2"}]}}, "WindowsEC2Instance3": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t2.micro", "KeyName": "your-key-pair", "IamInstanceProfile": "EC2InstanceSSMRole", "Tags": [{"Key": "Name", "Value": "WindowsEC2Instance3"}]}}, "SSMAssociationLinux": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "LinuxEC2Instance"}, "Parameters": {"directoryId": ["your-directory-id"], "directoryName": ["your-directory-name"], "dnsIpAddresses": ["your-dns-ip1", "your-dns-ip2"]}}}, "SSMAssociationWindows1": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "WindowsEC2Instance1"}, "Parameters": {"directoryId": ["your-directory-id"], "directoryName": ["your-directory-name"], "dnsIpAddresses": ["your-dns-ip1", "your-dns-ip2"]}}}, "SSMAssociationWindows2": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "WindowsEC2Instance2"}, "Parameters": {"directoryId": ["your-directory-id"], "directoryName": ["your-directory-name"], "dnsIpAddresses": ["your-dns-ip1", "your-dns-ip2"]}}}, "SSMAssociationWindows3": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "Targets": [{"Key": "tag:Name", "Values": ["WindowsEC2Instance3"]}], "Parameters": {"directoryId": ["your-directory-id"], "directoryName": ["your-directory-name"], "dnsIpAddresses": ["your-dns-ip1", "your-dns-ip2"]}}}}, "Outputs": {"LinuxEC2InstanceId": {"Description": "ID of the Linux EC2 instance", "Value": {"Ref": "LinuxEC2Instance"}}, "WindowsEC2Instance1Id": {"Description": "ID of the first Windows EC2 instance", "Value": {"Ref": "WindowsEC2Instance1"}}, "WindowsEC2Instance2Id": {"Description": "ID of the second Windows EC2 instance", "Value": {"Ref": "WindowsEC2Instance2"}}, "WindowsEC2Instance3Id": {"Description": "ID of the third Windows EC2 instance", "Value": {"Ref": "WindowsEC2Instance3"}}}}