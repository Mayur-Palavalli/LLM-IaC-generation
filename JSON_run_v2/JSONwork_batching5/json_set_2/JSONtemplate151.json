{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create an AD Connector to connect to an on-premises directory, seamless domain join resources, domain members security group, and DHCPOptionSet.", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID for the resources"}, "Subnets": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "Subnets for the AD Connector"}, "ADConnectorDnsIpAddresses": {"Type": "CommaDelimitedList", "Description": "The IP addresses of the DNS servers in the on-premises directory"}, "UserName": {"Type": "String", "Description": "The username of an account in the on-premises directory that has sufficient privileges to join computers to the domain"}, "Password": {"Type": "String", "Description": "The password for the username", "NoEcho": true}, "DomainDNSName": {"Type": "String", "Description": "Fully qualified domain name (FQDN) of the on-premises directory"}, "DomainNetBIOSName": {"Type": "String", "Description": "NetBIOS name of the on-premises directory"}, "CreateDomainJoinResources": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Create seamless domain join resources for Windows & Linux EC2 instances"}, "CreateSecurityGroup": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Create a domain members security group that allows all PrivateIP communications inbound"}, "CreateDHCPOptionsSet": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Create a DHCPOptionSet pointing to Domain DNS servers"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "DomainDNSName"}, "ShortName": {"Ref": "DomainNetBIOSName"}, "Password": {"Ref": "Password"}, "Edition": "Standard", "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "Subnets"}}}}, "SecurityGroup": {"Condition": "CreateSecurityGroupCondition", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for domain members allowing PrivateIP communication", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "SourceSecurityGroupId": {"Ref": "SecurityGroupSelf"}}]}}, "SecurityGroupSelf": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Temporary Security Group to avoid circular dependency", "VpcId": {"Ref": "VpcId"}}}, "DHCPOptionsSet": {"Condition": "CreateDHCPOptionsSetCondition", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "DomainDNSName"}, "DomainNameServers": {"Ref": "ADConnectorDnsIpAddresses"}}}, "DHCPOptionsAssociation": {"Condition": "CreateDHCPOptionsSetCondition", "Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"DhcpOptionsId": {"Ref": "DHCPOptionsSet"}, "VpcId": {"Ref": "VpcId"}}}}, "Conditions": {"CreateSecurityGroupCondition": {"Fn::Equals": [{"Ref": "CreateSecurityGroup"}, "Yes"]}, "CreateDHCPOptionsSetCondition": {"Fn::Equals": [{"Ref": "CreateDHCPOptionsSet"}, "Yes"]}}}