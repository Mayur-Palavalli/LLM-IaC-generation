{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to provision AWS Neptune Graph Database with AWS CloudWatch and AWS SNS for monitoring and notifications", "Resources": {"NeptuneClusterParameterGroup": {"Type": "AWS::Neptune::DBClusterParameterGroup", "Properties": {"Description": "Neptune cluster parameter group", "Family": "neptune1", "Parameters": {"neptune_enable_audit_log": "1"}}}, "NeptuneCluster": {"Type": "AWS::Neptune::DBCluster", "Properties": {"BackupRetentionPeriod": 7, "DBClusterParameterGroupName": {"Ref": "NeptuneClusterParameterGroup"}, "DBSubnetGroupName": {"Ref": "NeptuneSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "NeptuneSecurityGroup"}]}}, "NeptuneInstance": {"Type": "AWS::Neptune::DBInstance", "Properties": {"DBInstanceClass": "db.r5.large", "DBClusterIdentifier": {"Ref": "NeptuneCluster"}}}, "NeptuneSubnetGroup": {"Type": "AWS::Neptune::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Neptune", "SubnetIds": ["subnet-0123456789abcdef0", "subnet-abcdefgh123456789"]}}, "NeptuneSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for Neptune", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 8182, "ToPort": 8182, "CidrIp": "0.0.0.0/0"}]}}, "SNSRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "cloudwatch.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "SNSPublishPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": "sns:Publish", "Resource": "*"}]}}]}}, "AlarmTopic": {"Type": "AWS::SNS::Topic", "Properties": {"Subscription": [{"Protocol": "email", "Endpoint": "example@example.com"}]}}, "NeptuneCPUUtilizationAlarm": {"Type": "AWS::CloudWatch::Alarm", "Properties": {"AlarmName": "NeptuneCPUUtilization", "AlarmDescription": "Alarm if CPU exceeds 80%", "Namespace": "AWS/Neptune", "MetricName": "CPUUtilization", "Dimensions": [{"Name": "DBClusterIdentifier", "Value": {"Ref": "NeptuneCluster"}}], "Statistic": "Average", "Period": 300, "EvaluationPeriods": 2, "Threshold": 80, "ComparisonOperator": "GreaterThanThreshold", "AlarmActions": [{"Ref": "AlarmTopic"}], "InsufficientDataActions": [], "OKActions": []}}}, "Outputs": {"NeptuneClusterEndpoint": {"Value": {"Fn::GetAtt": ["NeptuneCluster", "Endpoint"]}}, "NeptuneReaderEndpoint": {"Value": {"Fn::GetAtt": ["NeptuneCluster", "ReadEndpoint"]}}}, "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The VPC Id of the target environment"}}}