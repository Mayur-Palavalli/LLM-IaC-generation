{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create one Linux and three Windows EC2 instances and join them to Active Directory using the 'AWS-JoinDirectoryServiceDomain' SSM document.", "Parameters": {"ADDirectoryId": {"Description": "The ID of the AWS Managed Microsoft AD or AD Connector directory.", "Type": "String"}, "InstanceType": {"Description": "EC2 instance type", "Type": "String", "Default": "t2.micro"}, "KeyPairName": {"Description": "EC2 Key Pair", "Type": "AWS::EC2::KeyPair::KeyName"}, "DNSServers": {"Description": "Optional: Specify DNS servers for EC2 instances if necessary.", "Type": "CommaDelimitedList", "Default": ""}}, "Resources": {"LinuxInstance": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "InstanceType"}, "KeyName": {"Ref": "KeyPairName"}, "ImageId": "ami-0abcdef1234567890", "NetworkInterfaces": []}}, "WindowsInstance1": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "InstanceType"}, "KeyName": {"Ref": "KeyPairName"}, "ImageId": "ami-0fedcba0987654321", "NetworkInterfaces": []}}, "WindowsInstance2": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "InstanceType"}, "KeyName": {"Ref": "KeyPairName"}, "ImageId": "ami-0fedcba0987654321", "NetworkInterfaces": []}}, "WindowsInstance3": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "InstanceType"}, "KeyName": {"Ref": "KeyPairName"}, "ImageId": "ami-0fedcba0987654321", "NetworkInterfaces": []}}, "SSMAssociationLinuxInstance": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "LinuxInstance"}, "Parameters": {"directoryId": [{"Ref": "ADDirectoryId"}], "directoryName": ["example.com"], "DNSIPAddresses": []}}}, "SSMAssociationWindowsInstances": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "Targets": [{"Key": "InstanceIds", "Values": [{"Ref": "WindowsInstance1"}, {"Ref": "WindowsInstance2"}, {"Ref": "WindowsInstance3"}]}], "Parameters": {"directoryId": [{"Ref": "ADDirectoryId"}], "directoryName": ["example.com"], "DNSIPAddresses": []}}}}}