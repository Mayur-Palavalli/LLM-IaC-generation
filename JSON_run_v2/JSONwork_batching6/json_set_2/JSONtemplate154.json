{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for AD Connector with optional seamless domain join, security group, and DHCP option set.", "Parameters": {"ConnectorDnsIpAddresses": {"Type": "List<AWS::EC2::IPAddress>", "Description": "DNS IP addresses for the AD Connector."}, "CustomerDnsIpAddresses": {"Type": "List<AWS::EC2::IPAddress>", "Description": "DNS IP addresses for the on-premises AD."}, "CustomerDomainName": {"Type": "String", "Description": "Domain name for the on-premises AD."}, "Password": {"Type": "String", "Description": "Password for AD Connector", "NoEcho": "true"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::Directory", "Properties": {"Name": {"Ref": "CustomerDomainName"}, "Password": {"Fn::Sub": "{{resolve:ssm-secure:/adconnector/password:1}}"}, "Size": "Small", "ConnectSettings": {"CustomerDnsIps": {"Ref": "CustomerDnsIpAddresses"}, "CustomerUserName": "admin", "SubnetIds": ["subnet-XXXXXXXX", "subnet-XXXXXXXX"], "VpcId": "vpc-XXXXXXXX"}, "Tags": [{"Key": "Name", "Value": "ADConnector"}]}}, "DomainMembersSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow all PrivateIP communications inbound within the domain.", "VpcId": "vpc-XXXXXXXX", "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/16"}], "Tags": [{"Key": "Name", "Value": "DomainMembersSecurityGroup"}]}}, "DHCPOptions": {"Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainNameServers": {"Ref": "CustomerDnsIpAddresses"}, "Tags": [{"Key": "Name", "Value": "CustomDHCPOptionSet"}]}}, "DHCPOptionsAssociation": {"Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"DhcpOptionsId": {"Ref": "DHCPOptions"}, "VpcId": "vpc-XXXXXXXX"}}}, "Outputs": {"ADConnectorId": {"Description": "The AD Connector ID", "Value": {"Ref": "ADConnector"}}, "DomainMembersSecurityGroupId": {"Description": "The security group ID for domain members", "Value": {"Ref": "DomainMembersSecurityGroup"}}, "DHCPOptionsId": {"Description": "The DHCP Options set ID", "Value": {"Ref": "DHCPOptions"}}}}