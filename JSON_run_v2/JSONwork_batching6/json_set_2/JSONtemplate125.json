{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to provision an AWS Neptune Graph Database with CloudWatch and SNS for CI/CD", "Parameters": {"ClusterName": {"Type": "String", "Description": "Name of the Neptune DB Cluster"}, "DBInstanceClass": {"Type": "String", "Default": "db.r5.large", "AllowedValues": ["db.r4.large", "db.r4.xlarge", "db.r4.2xlarge", "db.r4.4xlarge", "db.r4.8xlarge", "db.r5.large", "db.r5.xlarge", "db.r5.2xlarge", "db.r5.4xlarge", "db.r5.8xlarge", "db.r5.12xlarge", "db.r5.16xlarge", "db.r5.24xlarge"], "Description": "The compute and memory capacity of the DB instance"}, "SNSTopicName": {"Type": "String", "Description": "Name of the SNS Topic for notifications"}, "EmailAddress": {"Type": "String", "Description": "Email address for SNS notifications"}, "SubnetIds": {"Type": "CommaDelimitedList", "Description": "List of Subnet IDs for the Neptune Subnet Group"}, "VpcId": {"Type": "String", "Description": "VPC ID for the Neptune Security Group"}}, "Resources": {"NeptuneDBCluster": {"Type": "AWS::Neptune::DBCluster", "Properties": {"DBClusterIdentifier": {"Ref": "ClusterName"}, "AvailabilityZones": {"Fn::GetAZs": ""}, "VpcSecurityGroupIds": [{"Ref": "NeptuneSecurityGroup"}], "BackupRetentionPeriod": 7, "DBClusterParameterGroupName": "default.neptune1", "DBSubnetGroupName": {"Ref": "NeptuneSubnetGroup"}, "StorageEncrypted": true, "PreferredBackupWindow": "07:34-08:04", "PreferredMaintenanceWindow": "sun:23:45-mon:00:15"}}, "NeptuneDBInstance": {"Type": "AWS::Neptune::DBInstance", "Properties": {"DBInstanceClass": {"Ref": "DBInstanceClass"}, "DBClusterIdentifier": {"Ref": "NeptuneDBCluster"}}}, "NeptuneSubnetGroup": {"Type": "AWS::Neptune::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Neptune", "SubnetIds": {"Ref": "SubnetIds"}}}, "NeptuneSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Neptune Security Group", "VpcId": {"Ref": "VpcId"}}}, "SNSTopic": {"Type": "AWS::SNS::Topic", "Properties": {"TopicName": {"Ref": "SNSTopicName"}, "Subscription": [{"Endpoint": {"Ref": "EmailAddress"}, "Protocol": "email"}]}}, "CloudWatchAlarmCPUUtilization": {"Type": "AWS::CloudWatch::Alarm", "Properties": {"AlarmName": "NeptuneCPUUtilizationAlarm", "AlarmDescription": "Alarm for CPU Utilization on Neptune Cluster", "MetricName": "CPUUtilization", "Namespace": "AWS/Neptune", "Statistic": "Average", "Period": "300", "EvaluationPeriods": "1", "Threshold": "80", "ComparisonOperator": "GreaterThanOrEqualToThreshold", "Dimensions": [{"Name": "DBClusterIdentifier", "Value": {"Ref": "ClusterName"}}], "AlarmActions": [{"Ref": "SNSTopic"}]}}}, "Outputs": {"DBClusterEndpoint": {"Description": "Endpoint address of the Neptune DB cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "Endpoint"]}}}}