{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": "true", "EnableDnsHostnames": "true", "Tags": [{"Key": "Name", "Value": "MyVPC"}]}}, "MySubnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}}}, "MySecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow access to RDS and DMS", "VpcId": {"Ref": "MyVPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}, {"IpProtocol": "tcp", "FromPort": 5432, "ToPort": 5432, "CidrIp": "0.0.0.0/0"}]}}, "MyAuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": "myPassword123", "VpcSecurityGroupIds": [{"Ref": "MySecurityGroup"}], "DBSubnetGroupName": {"Ref": "MyDBSubnetGroup"}}}, "MyDBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora DB", "SubnetIds": [{"Ref": "MySubnet"}]}}, "MyS3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "my-dms-target-bucket"}}, "MyDMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t2.micro", "VpcSecurityGroupIds": [{"Ref": "MySecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "MyDMSSubnetGroup"}}}, "MyDMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupIdentifier": "my-dms-subnet-group", "ReplicationSubnetGroupDescription": "Subnet group for DMS", "SubnetIds": [{"Ref": "MySubnet"}]}}, "MyDMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "my-aurora-source", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": "myPassword123", "ServerName": {"Fn::GetAtt": ["MyAuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydb"}}, "MyDMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "my-s3-target", "EndpointType": "target", "EngineName": "s3", "BucketName": {"Ref": "MyS3Bucket"}, "S3Settings": {"BucketFolder": "dms-data"}}}, "MyDMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "SourceEndpointArn": {"Ref": "MyDMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "MyDMSTargetEndpoint"}, "ReplicationInstanceArn": {"Ref": "MyDMSReplicationInstance"}, "TableMappings": "{\"rules\":[{\"rule-type\":\"selection\",\"rule-id\":\"1\",\"rule-name\":\"1\",\"object-locator\":{\"schema-name\":\"%\",\"table-name\":\"%\"},\"rule-action\":\"include\"}]}", "TaskSettings": "{}"}}}}