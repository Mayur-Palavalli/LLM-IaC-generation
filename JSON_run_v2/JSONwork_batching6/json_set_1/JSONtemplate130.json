{"AWSTemplateFormatVersion": "2010-09-09", "Description": "Highly-available RDS DBInstance with a read replica", "Resources": {"DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for the RDS instance", "SubnetIds": [{"Ref": "SubnetA"}, {"Ref": "SubnetB"}]}}, "MyDBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for my RDS instance", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3306", "ToPort": "3306", "CidrIp": "0.0.0.0/0"}]}}, "MyRDSInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"AllocatedStorage": "20", "DBInstanceClass": "db.t3.micro", "Engine": "mysql", "MasterUsername": {"Ref": "DBUsername"}, "MasterUserPassword": {"Ref": "DBPassword"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VPCSecurityGroups": [{"Fn::GetAtt": ["MyDBSecurityGroup", "GroupId"]}], "MultiAZ": true, "BackupRetentionPeriod": 7}}, "MyReadReplica": {"Type": "AWS::RDS::DBInstance", "Properties": {"SourceDBInstanceIdentifier": {"Ref": "MyRDSInstance"}, "DBInstanceClass": "db.t3.micro", "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VPCSecurityGroups": [{"Fn::GetAtt": ["MyDBSecurityGroup", "GroupId"]}]}}}, "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The ID of the VPC"}, "SubnetA": {"Type": "AWS::EC2::Subnet::Id", "Description": "The ID of subnet A"}, "SubnetB": {"Type": "AWS::EC2::Subnet::Id", "Description": "The ID of subnet B"}, "DBUsername": {"Type": "String", "Description": "The database admin account username"}, "DBPassword": {"Type": "String", "NoEcho": true, "Description": "The database admin account password"}}, "Outputs": {"PrimaryDBEndpoint": {"Description": "Primary RDS DB Instance endpoint", "Value": {"Fn::GetAtt": ["MyRDSInstance", "Endpoint.Address"]}}, "ReadReplicaEndpoint": {"Description": "Read Replica DB Instance endpoint", "Value": {"Fn::GetAtt": ["MyReadReplica", "Endpoint.Address"]}}}}