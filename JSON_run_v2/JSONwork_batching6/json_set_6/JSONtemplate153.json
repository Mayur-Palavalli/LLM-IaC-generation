{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for AD Connector to connect to an on-premises directory.", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The ID of the VPC where the AD Connector should be created."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "The subnets in which to create the AD Connector."}, "DnsIpAddresses": {"Type": "List<String>", "Description": "The IP addresses of the DNS servers for the on-premises directory."}, "DomainName": {"Type": "String", "Description": "The fully qualified name of the on-premises directory."}, "CreateDomainMembersSecurityGroup": {"Type": "String", "AllowedValues": ["true", "false"], "Description": "Condition to create Domain Members Security Group"}, "CreateDHCPOptionSet": {"Type": "String", "AllowedValues": ["true", "false"], "Description": "Condition to create DHCP Option Set"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "DomainName"}, "Password": "{{resolve:ssm-secure:/adconnector/password:1}}", "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "DomainMembersSecurityGroup": {"Condition": "CreateDomainMembersSecurityGroupCondition", "Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VpcId"}, "GroupDescription": "Security group for domain members", "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/8"}]}}, "DHCPOptionSet": {"Condition": "CreateDHCPOptionSetCondition", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "DomainName"}, "DomainNameServers": {"Ref": "DnsIpAddresses"}}}, "VPCDHCPOptionsAssociation": {"Condition": "CreateDHCPOptionSetCondition", "Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"VpcId": {"Ref": "VpcId"}, "DhcpOptionsId": {"Ref": "DHCPOptionSet"}}}}, "Conditions": {"CreateDomainMembersSecurityGroupCondition": {"Fn::Equals": [{"Ref": "CreateDomainMembersSecurityGroup"}, "true"]}, "CreateDHCPOptionSetCondition": {"Fn::Equals": [{"Ref": "CreateDHCPOptionSet"}, "true"]}}, "Outputs": {"ADConnectorId": {"Value": {"Ref": "ADConnector"}, "Description": "The ID of the AD Connector."}}}