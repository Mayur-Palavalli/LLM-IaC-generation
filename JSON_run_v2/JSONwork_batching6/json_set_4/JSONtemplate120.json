{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "MyChannel", "RetentionPeriod": {"NumberOfDays": 3, "Unlimited": false}}}, "MyDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "MyDatastore", "RetentionPeriod": {"NumberOfDays": 3, "Unlimited": false}}}, "MyPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "MyPipeline", "PipelineActivities": [{"Channel": {"ChannelName": {"Ref": "MyChannel"}, "Name": "ChannelActivity"}}, {"Datastore": {"DatastoreName": {"Ref": "MyDatastore"}, "Name": "DatastoreActivity"}}]}}, "MyDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "MyDataset", "ContentDeliveryRules": [{"Destination": {"S3DestinationConfiguration": {"Bucket": "YourBucketName", "Key": "YourKey", "RoleArn": "arn:aws:iam::123456789012:role/YourRole"}}}], "Actions": [{"ActionName": "SQLQueryAction", "QueryAction": {"SqlQuery": "SELECT * FROM ${MyDatastore}", "Filters": []}}]}}}}