{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Template to provision AWS Neptune Graph Database with CI/CD method, AWS CloudWatch, and AWS SNS", "Resources": {"NeptuneDBCluster": {"Type": "AWS::Neptune::DBCluster", "Properties": {"DBClusterIdentifier": "my-neptune-db-cluster", "BackupRetentionPeriod": 7, "PreferredBackupWindow": "07:00-09:00", "PreferredMaintenanceWindow": "Mon:00:00-Mon:03:00", "StorageEncrypted": true}}, "NeptuneDBInstance": {"Type": "AWS::Neptune::DBInstance", "Properties": {"DBInstanceClass": "db.r5.large", "DBClusterIdentifier": {"Ref": "NeptuneDBCluster"}}}, "NeptuneDBClusterParameterGroup": {"Type": "AWS::Neptune::DBClusterParameterGroup", "Properties": {"Description": "My Neptune cluster parameter group", "Family": "neptune1", "Parameters": {"neptune_query_timeout": "7200000"}}}, "NeptuneDBParameterGroup": {"Type": "AWS::Neptune::DBParameterGroup", "Properties": {"Description": "My Neptune DB parameter group", "Family": "neptune1", "Parameters": {"neptune_enable_audit_log": "1"}}}, "MyDeploymentPipeline": {"Type": "AWS::CodePipeline::Pipeline", "Properties": {"RoleArn": "arn:aws:iam::<account-id>:role/<role-name>", "Stages": [{"Name": "Source", "Actions": [{"Name": "Source", "ActionTypeId": {"Category": "Source", "Owner": "AWS", "Provider": "S3", "Version": "1"}, "Configuration": {"S3Bucket": "my-source-bucket", "S3ObjectKey": "source.zip"}, "OutputArtifacts": [{"Name": "SourceOutput"}], "RunOrder": 1}]}, {"Name": "Deploy", "Actions": [{"Name": "Deploy", "ActionTypeId": {"Category": "Deploy", "Owner": "AWS", "Provider": "CloudFormation", "Version": "1"}, "Configuration": {"ActionMode": "CREATE_UPDATE", "StackName": "my-stack", "TemplatePath": "SourceOutput::template.json"}, "InputArtifacts": [{"Name": "SourceOutput"}], "RunOrder": 1}]}], "ArtifactStore": {"Type": "S3", "Location": "my-artifact-store-bucket"}}}, "CloudWatchAlarm": {"Type": "AWS::CloudWatch::Alarm", "Properties": {"AlarmDescription": "Alarm if CPU utilization exceeds 80%", "Namespace": "AWS/Neptune", "MetricName": "CPUUtilization", "Dimensions": [{"Name": "DBInstanceIdentifier", "Value": {"Ref": "NeptuneDBInstance"}}], "Statistic": "Average", "Period": 300, "EvaluationPeriods": 1, "Threshold": 80, "ComparisonOperator": "GreaterThanThreshold", "AlarmActions": [{"Ref": "SNSTopic"}]}}, "SNSTopic": {"Type": "AWS::SNS::Topic", "Properties": {"TopicName": "NeptuneAlarmTopic"}}, "SNSTopicSubscription": {"Type": "AWS::SNS::Subscription", "Properties": {"Endpoint": "example@example.com", "Protocol": "email", "TopicArn": {"Ref": "SNSTopic"}}}}, "Outputs": {"NeptuneDBClusterEndpoint": {"Description": "Endpoint address of the Neptune DB cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "Endpoint"]}}, "NeptuneDBClusterReadEndpoint": {"Description": "Read endpoint address of the Neptune DB cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "ReadEndpoint"]}}}}