{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true, "Tags": [{"Key": "Name", "Value": "MyVPC"}]}}, "MySubnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "Name", "Value": "MySubnet"}]}}, "MyAuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": {"Ref": "MyDBMasterUsername"}, "MasterUserPassword": {"Ref": "MyDBMasterUserPassword"}, "DBSubnetGroupName": {"Ref": "MyDBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "MyDBSecurityGroup"}]}}, "MyAuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "MyAuroraDBCluster"}, "DBInstanceClass": "db.t3.medium"}}, "MyDBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "My DB Subnet Group", "SubnetIds": [{"Ref": "MySubnet"}]}}, "MyDBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow RDS access", "VpcId": {"Ref": "MyVPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "MyS3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "my-dms-bucket"}}, "MyDMSVpcRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "dms.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "DMSVpcPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": "ec2:Describe*", "Resource": "*"}]}}]}}, "MyReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupIdentifier": "my-replication-subnet-group", "ReplicationSubnetGroupDescription": "My replication subnet group", "SubnetIds": [{"Ref": "MySubnet"}]}}, "MyReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t3.medium", "VpcSecurityGroupIds": [{"Ref": "MyDBSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "MyReplicationSubnetGroup"}}}, "MySourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": {"Ref": "MyDBMasterUsername"}, "Password": {"Ref": "MyDBMasterUserPassword"}, "ServerName": {"Fn::GetAtt": ["MyAuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "MyTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "MyS3Bucket"}, "ServiceAccessRoleArn": {"Fn::GetAtt": ["MyDMSVpcRole", "Arn"]}}}}, "MyDMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationTaskIdentifier": "dms-task", "SourceEndpointArn": {"Fn::GetAtt": ["MySourceEndpoint", "EndpointArn"]}, "TargetEndpointArn": {"Fn::GetAtt": ["MyTargetEndpoint", "EndpointArn"]}, "MigrationType": "full-load-and-cdc", "TableMappings": "{\"rules\":[{\"rule-type\":\"selection\",\"rule-id\":\"1\",\"rule-name\":\"1\",\"object-locator\":{\"schema-name\":\"%\",\"table-name\":\"%\"},\"rule-action\":\"include\"}]}", "ReplicationTaskSettings": "{\"TargetMetadata\":{\"TargetSchema\":\"\",\"SupportLobs\":true,\"FullLobMode\":false,\"LobChunkSize\":64,\"LimitedSizeLobMode\":true,\"LobMaxSize\":32,\"InlineLobMaxSize\":0,\"LoadMaxFileSize\":0,\"ParallelLoadThreads\":1,\"ParallelLoadBufferSize\":0,\"BatchApplyEnabled\":false},\"Logging\":{\"EnableLogging\":true}}", "ReplicationInstanceArn": {"Ref": "MyReplicationInstance"}}}}, "Parameters": {"MyDBMasterUsername": {"Type": "String", "Description": "The RDS master username"}, "MyDBMasterUserPassword": {"Type": "String", "NoEcho": true, "Description": "The RDS master user password"}}}