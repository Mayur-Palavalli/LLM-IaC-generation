{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for Linux and Windows EC2 instances joined to Active Directory using SSM 'AWS-JoinDirectoryServiceDomain'.", "Parameters": {"ADDomainName": {"Type": "String", "Description": "The domain name of the Active Directory"}, "DomainOU": {"Type": "String", "Description": "The Organizational Unit (OU) within Active Directory"}, "DNSIpAddresses": {"Type": "CommaDelimitedList", "Description": "The comma-delimited list of DNS server IP addresses"}, "LinuxInstanceType": {"Type": "String", "Description": "EC2 instance type for Linux", "Default": "t2.micro"}, "WindowsInstanceType": {"Type": "String", "Description": "EC2 instance type for Windows", "Default": "t2.micro"}}, "Resources": {"LinuxInstance": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "LinuxInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": "your-key-pair", "Tags": [{"Key": "Name", "Value": "LinuxInstance"}]}}, "WindowsInstance1": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "WindowsInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": "your-key-pair", "Tags": [{"Key": "Name", "Value": "WindowsInstance1"}]}}, "WindowsInstance2": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "WindowsInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": "your-key-pair", "Tags": [{"Key": "Name", "Value": "WindowsInstance2"}]}}, "WindowsInstance3": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "WindowsInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": "your-key-pair", "Tags": [{"Key": "Name", "Value": "WindowsInstance3"}]}}, "LinuxSSMAssociation": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "LinuxInstance"}, "Parameters": {"directoryId": [{"Ref": "ADDomainName"}], "directoryName": [{"Ref": "ADDomainName"}], "dnsIpAddresses": {"Ref": "DNSIpAddresses"}, "directoryOU": [{"Ref": "DomainOU"}], "instanceArea": [{"Ref": "AWS::Region"}]}, "WaitForSuccessTimeoutSeconds": 600}}, "WindowsSSMAssociation1": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "WindowsInstance1"}, "Parameters": {"directoryId": [{"Ref": "ADDomainName"}], "directoryName": [{"Ref": "ADDomainName"}], "dnsIpAddresses": {"Ref": "DNSIpAddresses"}, "directoryOU": [{"Ref": "DomainOU"}], "instanceArea": [{"Ref": "AWS::Region"}]}, "WaitForSuccessTimeoutSeconds": 600}}, "WindowsSSMAssociation2": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "WindowsInstance2"}, "Parameters": {"directoryId": [{"Ref": "ADDomainName"}], "directoryName": [{"Ref": "ADDomainName"}], "dnsIpAddresses": {"Ref": "DNSIpAddresses"}, "directoryOU": [{"Ref": "DomainOU"}], "instanceArea": [{"Ref": "AWS::Region"}]}, "WaitForSuccessTimeoutSeconds": 600}}, "WindowsSSMAssociation3": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "WindowsInstance3"}, "Parameters": {"directoryId": [{"Ref": "ADDomainName"}], "directoryName": [{"Ref": "ADDomainName"}], "dnsIpAddresses": {"Ref": "DNSIpAddresses"}, "directoryOU": [{"Ref": "DomainOU"}], "instanceArea": [{"Ref": "AWS::Region"}]}, "WaitForSuccessTimeoutSeconds": 600}}}}