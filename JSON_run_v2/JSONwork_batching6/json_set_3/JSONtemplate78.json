{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Sample Template EKS Cluster on EC2", "Resources": {"EKSClusterRole": {"Type": "AWS::IAM::Role", "Properties": {"RoleName": "eksClusterRole", "AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "eks.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"]}}, "EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": "eks-sample-cluster", "RoleArn": {"Fn::GetAtt": ["EKSClusterRole", "Arn"]}, "ResourcesVpcConfig": {"SubnetIds": ["subnet-xxxxxxxx", "subnet-yyyyyyyy"], "SecurityGroupIds": [{"Ref": "SecurityGroup1"}]}}}, "EKSEC2Role": {"Type": "AWS::IAM::Role", "Properties": {"RoleName": "eksNodeInstanceRole", "AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy", "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy", "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"]}}, "EKSEC2InstanceProfile": {"Type": "AWS::IAM::InstanceProfile", "Properties": {"InstanceProfileName": "eksNodeInstanceProfile", "Roles": [{"Ref": "EKSEC2Role"}]}}, "NodeGroupLaunchTemplate": {"Type": "AWS::EC2::LaunchTemplate", "Properties": {"LaunchTemplateName": "eks-nodegroup-launch-template", "LaunchTemplateData": {"IamInstanceProfile": {"Arn": {"Fn::GetAtt": ["EKSEC2InstanceProfile", "Arn"]}}, "ImageId": "ami-12345678", "InstanceType": "t3.medium", "SecurityGroupIds": [{"Ref": "SecurityGroup2"}], "KeyName": "eks-keypair"}}}, "SecurityGroup1": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "EKS Cluster Security Group", "VpcId": {"Ref": "VpcId"}}}, "SecurityGroup2": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "EKS Node Group Security Group", "VpcId": {"Ref": "VpcId"}}}}, "Outputs": {"EKSClusterName": {"Description": "Name of the EKS Cluster", "Value": {"Ref": "EKSCluster"}}, "EKSEC2RoleArn": {"Description": "ARN of the EC2 Role for EKS Cluster", "Value": {"Fn::GetAtt": ["EKSEC2Role", "Arn"]}}}}