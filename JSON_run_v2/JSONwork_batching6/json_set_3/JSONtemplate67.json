{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create an EC2 instance with a single ENI that has multiple private and public IP addresses.", "Resources": {"MyEC2Instance": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t2.micro", "KeyName": "my-key-pair", "NetworkInterfaces": [{"AssociatePublicIpAddress": true, "DeviceIndex": "0", "SubnetId": "subnet-xxxxxxxx", "NetworkInterfaceId": {"Ref": "MyElasticNetworkInterface"}}], "Tags": [{"Key": "Name", "Value": "MyEC2Instance"}], "ImageId": "ami-xxxxxxxx"}}, "MyElasticNetworkInterface": {"Type": "AWS::EC2::NetworkInterface", "Properties": {"SubnetId": "subnet-xxxxxxxx", "PrivateIpAddresses": [{"Primary": true, "PrivateIpAddress": "10.0.0.10"}, {"PrivateIpAddress": "10.0.0.11"}], "Description": "ENI with multiple IPs", "GroupSet": [{"Ref": "MySecurityGroup"}]}}, "MyElasticIPAddress": {"Type": "AWS::EC2::EIP", "Properties": {"Domain": "vpc", "InstanceId": {"Ref": "MyEC2Instance"}}}, "MySecondaryElasticIPAddress": {"Type": "AWS::EC2::EIP", "Properties": {"Domain": "vpc"}}, "SecondaryEIPAssociation": {"Type": "AWS::EC2::EIPAssociation", "Properties": {"AllocationId": {"Fn::GetAtt": ["MySecondaryElasticIPAddress", "AllocationId"]}, "NetworkInterfaceId": {"Ref": "MyElasticNetworkInterface"}, "PrivateIpAddress": "10.0.0.11"}}, "MySecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow SSH and HTTP", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "22", "ToPort": "22", "CidrIp": "0.0.0.0/0"}, {"IpProtocol": "tcp", "FromPort": "80", "ToPort": "80", "CidrIp": "0.0.0.0/0"}], "VpcId": "vpc-xxxxxxxx"}}}, "Outputs": {"InstanceId": {"Description": "InstanceId of the newly created EC2 instance", "Value": {"Ref": "MyEC2Instance"}}, "PublicIP": {"Description": "Public IP address of the newly created EC2 instance", "Value": {"Fn::GetAtt": ["MyElasticIPAddress", "PublicIp"]}}, "SecondaryPublicIP": {"Description": "Secondary Public IP address", "Value": {"Ref": "MySecondaryElasticIPAddress"}}}}