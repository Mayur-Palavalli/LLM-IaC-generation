{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Sample Template for creating an EKS Cluster on EC2", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "ID of an existing VPC"}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "The Subnets to use for the Auto Scaling group"}, "ClusterName": {"Type": "String", "Description": "The name of the EKS Cluster", "Default": "MyEKSCluster"}, "NodeGroupName": {"Type": "String", "Description": "The name of the EKS Node Group", "Default": "MyEKSNodeGroup"}, "InstanceType": {"Type": "String", "Description": "The EC2 instance type for the nodes", "Default": "t3.medium", "AllowedValues": ["t3.medium", "m5.large", "m5.xlarge", "m5.2xlarge"]}}, "Resources": {"EKSClusterRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "eks.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"], "Policies": [{"PolicyName": "EKSClusterPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["ec2:DescribeSubnets", "ec2:DescribeSecurityGroups", "ec2:DescribeRouteTables", "ec2:DescribeVpcs"], "Resource": "*"}]}}]}}, "EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": {"Ref": "ClusterName"}, "RoleArn": {"Fn::GetAtt": ["EKSClusterRole", "Arn"]}, "ResourcesVpcConfig": {"SubnetIds": {"Ref": "SubnetIds"}}}}, "EKSNodeInstanceRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy", "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy", "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"]}}, "EKSNodeGroup": {"Type": "AWS::EKS::Nodegroup", "Properties": {"ClusterName": {"Ref": "ClusterName"}, "NodegroupName": {"Ref": "NodeGroupName"}, "NodeRole": {"Fn::GetAtt": ["EKSNodeInstanceRole", "Arn"]}, "Subnets": {"Ref": "SubnetIds"}, "ScalingConfig": {"MinSize": 1, "MaxSize": 3, "DesiredSize": 2}, "InstanceTypes": [{"Ref": "InstanceType"}], "AmiType": "AL2_x86_64", "RemoteAccess": {"Ec2SshKey": ""}, "Labels": {"purpose": "eks-node-group"}}}}, "Outputs": {"ClusterName": {"Description": "The name of the EKS Cluster", "Value": {"Ref": "ClusterName"}}, "NodeGroupName": {"Description": "The name of the EKS Node Group", "Value": {"Ref": "NodeGroupName"}}}}