{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MainBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "main-secure-bucket", "VersioningConfiguration": {"Status": "Enabled"}, "LoggingConfiguration": {"DestinationBucketName": {"Ref": "AccessLogBucket"}, "LogFilePrefix": "main-bucket-logs/"}, "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "ReplicaBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "replica-bucket", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "OwnershipControls": {"Rules": [{"ObjectOwnership": "BucketOwnerPreferred"}]}}}, "AccessLogBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "access-log-bucket", "AccessControl": "LogDeliveryWrite", "BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "LifecycleConfiguration": {"Rules": [{"Id": "LogDeletionRule", "Prefix": "main-bucket-logs/", "Status": "Enabled", "ExpirationInDays": 365}]}}}, "BucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Properties": {"Bucket": {"Ref": "MainBucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Deny", "Principal": "*", "Action": "s3:*", "Resource": [{"Fn::Join": ["", ["arn:aws:s3:::", {"Ref": "MainBucket"}, "/*"]]}, {"Fn::Join": ["", ["arn:aws:s3:::", {"Ref": "MainBucket"}]]}], "Condition": {"Bool": {"aws:SecureTransport": "false"}}}]}}}}}