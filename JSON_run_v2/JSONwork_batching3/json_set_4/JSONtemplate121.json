{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to provision Neptune DB with CI/CD support, CloudWatch, and SNS", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The VPC Id to create the Neptune DB instance in."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "The Subnets for the Neptune DB instance."}, "DBInstanceClass": {"Type": "String", "Default": "db.r5.large", "Description": "Neptune DB instance class"}, "DBPort": {"Type": "Number", "Default": 8182, "Description": "The port for the Neptune database"}, "SNSArn": {"Type": "String", "Description": "The ARN of the SNS topic for notifications"}}, "Resources": {"NeptuneClusterParameterGroup": {"Type": "AWS::Neptune::DBClusterParameterGroup", "Properties": {"Description": "Neptune cluster parameter group", "Family": "neptune1", "Parameters": {"neptune_enable_audit_log": "1"}}}, "NeptuneDBCluster": {"Type": "AWS::Neptune::DBCluster", "Properties": {"DBSubnetGroupName": {"Ref": "NeptuneDBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "NeptuneDBSecurityGroup"}], "DBClusterParameterGroupName": {"Ref": "NeptuneClusterParameterGroup"}, "Port": {"Ref": "DBPort"}, "StorageEncrypted": true, "BackupRetentionPeriod": 7}}, "NeptuneDBInstance": {"Type": "AWS::Neptune::DBInstance", "Properties": {"DBInstanceClass": {"Ref": "DBInstanceClass"}, "DBClusterIdentifier": {"Ref": "NeptuneDBCluster"}}}, "NeptuneDBSubnetGroup": {"Type": "AWS::Neptune::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Neptune DB", "SubnetIds": {"Ref": "SubnetIds"}}}, "NeptuneDBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for Neptune DB", "VpcId": {"Ref": "VpcId"}}}, "NeptuneDBCloudWatchAlarm": {"Type": "AWS::CloudWatch::Alarm", "Properties": {"AlarmDescription": "Alarm for Neptune DB CPU utilization", "Namespace": "AWS/Neptune", "MetricName": "CPUUtilization", "Dimensions": [{"Name": "DBInstanceIdentifier", "Value": {"Fn::GetAtt": ["NeptuneDBInstance", "DBInstanceIdentifier"]}}], "Statistic": "Average", "Period": 300, "EvaluationPeriods": 1, "Threshold": 80, "ComparisonOperator": "GreaterThanThreshold", "AlarmActions": [{"Ref": "SNSArn"}]}}}, "Outputs": {"DBClusterEndpoint": {"Description": "The endpoint for the Neptune DB cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "Endpoint"]}}}}