{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create an AD Connector to connect to an on-premises directory.", "Parameters": {"VPCId": {"Type": "AWS::EC2::VPC::Id", "Description": "The VPC in which to create the AD Connector."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "The subnets for the AD Connector."}, "ADConnectorName": {"Type": "String", "Description": "The name for the AD Connector."}, "ADConnectorSize": {"Type": "String", "Default": "Small", "AllowedValues": ["Small", "Large"], "Description": "The size of the AD Connector."}, "OnPremiseDNSIPs": {"Type": "List<String>", "Description": "The DNS server IPs on-premises."}, "EnableSeamlessDomainJoin": {"Type": "String", "Default": "false", "AllowedValues": ["true", "false"], "Description": "Set to true to enable the creation of seamless domain join resources for EC2 instances."}, "EnableDomainMembersSecurityGroup": {"Type": "String", "Default": "false", "AllowedValues": ["true", "false"], "Description": "Set to true to enable the creation of domain members security group."}, "EnableDHCPOptionSet": {"Type": "String", "Default": "false", "AllowedValues": ["true", "false"], "Description": "Set to true to create a DHCP option set with provided DNS servers."}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::SimpleAD", "Properties": {"Name": {"Ref": "ADConnectorName"}, "Password": "{{resolve:ssm-secure:ADConnectorPassword:1}}", "Size": {"Ref": "ADConnectorSize"}, "VpcSettings": {"VpcId": {"Ref": "VPCId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "DomainMembersSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Condition": "CreateDomainMembersSecurityGroup", "Properties": {"GroupDescription": "Allow all Private IP communications inbound", "VpcId": {"Ref": "VPCId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/8"}]}}, "DHCPOptionSet": {"Type": "AWS::EC2::DHCPOptions", "Condition": "CreateDHCPOptionSet", "Properties": {"DomainNameServers": {"Ref": "OnPremiseDNSIPs"}}}, "DHCPOptionsAssociation": {"Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Condition": "CreateDHCPOptionSet", "Properties": {"VpcId": {"Ref": "VPCId"}, "DhcpOptionsId": {"Ref": "DHCPOptionSet"}}}}, "Conditions": {"CreateDomainMembersSecurityGroup": {"Fn::Equals": [{"Ref": "EnableDomainMembersSecurityGroup"}, "true"]}, "CreateDHCPOptionSet": {"Fn::Equals": [{"Ref": "EnableDHCPOptionSet"}, "true"]}}, "Outputs": {"ADConnectorId": {"Description": "The ID of the AD Connector", "Value": {"Ref": "ADConnector"}}, "SecurityGroupId": {"Condition": "CreateDomainMembersSecurityGroup", "Description": "The ID of the Domain Members Security Group", "Value": {"Ref": "DomainMembersSecurityGroup"}}, "DHCPOptionsId": {"Condition": "CreateDHCPOptionSet", "Description": "The ID of the DHCP Options set", "Value": {"Ref": "DHCPOptionSet"}}}}