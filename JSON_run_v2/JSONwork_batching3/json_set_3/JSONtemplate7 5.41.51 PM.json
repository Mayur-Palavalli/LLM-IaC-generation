{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Sample Template for App Runner Service: This template demonstrates the creation of an App Runner Service using an existing ECR (Elastic Container Registry) repository.", "Resources": {"AppRunnerService": {"Type": "AWS::AppRunner::Service", "Properties": {"SourceConfiguration": {"AuthenticationConfiguration": {"AccessRoleArn": {"Ref": "ECRAccessRole"}}, "ImageRepository": {"ImageIdentifier": {"Ref": "ECRImageURI"}, "ImageRepositoryType": "ECR", "ImageConfiguration": {"Port": "80"}}}, "InstanceConfiguration": {"InstanceRoleArn": {"Ref": "ECRInstanceRole"}}, "ServiceName": "SampleAppRunnerService", "AutoScalingConfigurationArn": {"Ref": "AutoScalingConfiguration"}}}, "ECRAccessRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "build.apprunner.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "ECRReadOnly", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["ecr:GetDownloadUrlForLayer", "ecr:BatchGetImage"], "Resource": {"Ref": "ECRRepository"}}]}}]}}, "ECRInstanceRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": ["tasks.apprunner.amazonaws.com", "build.apprunner.amazonaws.com"]}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "AppRunnerECRInstancePolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["ecr:BatchCheckLayerAvailability", "ecr:GetAuthorizationToken", "ecr:GetDownloadUrlForLayer", "ecr:BatchGetImage", "logs:CreateLogStream", "logs:PutLogEvents"], "Resource": "*"}]}}]}}, "ECRRepository": {"Type": "AWS::ECR::Repository", "Properties": {"RepositoryName": "sample-repository"}}, "AutoScalingConfiguration": {"Type": "AWS::AppRunner::AutoScalingConfigurationVersion", "Properties": {"MaxConcurrency": 100}}}, "Parameters": {"ECRImageURI": {"Type": "String", "Description": "ECR Image URI, format '123456789012.dkr.ecr.region.amazonaws.com/repository-name:tag'"}}, "Outputs": {"AppRunnerServiceURL": {"Description": "URL of the App Runner Service", "Value": {"Fn::GetAtt": ["AppRunnerService", "ServiceUrl"]}}}}