{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for one Linux and three Windows EC2 instances joined to AD using AWS-JoinDirectoryServiceDomain SSM document", "Parameters": {"ADDomainName": {"Type": "String", "Description": "The domain name of the Active Directory"}, "DomainDNSIPAddress": {"Type": "CommaDelimitedList", "Description": "A list of DNS server IP addresses for the AD domain"}, "LinuxInstanceType": {"Type": "String", "Description": "Linux EC2 instance type", "Default": "t2.micro"}, "WindowsInstanceType": {"Type": "String", "Description": "Windows EC2 instance type", "Default": "t2.micro"}, "KeyName": {"Type": "AWS::EC2::KeyPair::KeyName", "Description": "The EC2 Key Pair to allow SSH access to the instances"}, "ADDirectoryID": {"Type": "String", "Description": "The ID of the AWS Directory Service Managed AD or AD Connector"}}, "Resources": {"LinuxInstance": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "LinuxInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": {"Ref": "KeyName"}, "AvailabilityZone": {"Fn::Select": ["0", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "InstanceType", "Value": "Linux"}]}}, "WindowsInstance1": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "WindowsInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": {"Ref": "KeyName"}, "AvailabilityZone": {"Fn::Select": ["1", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "InstanceType", "Value": "Windows"}], "AdditionalProperties": {"ADDomainName": {"Ref": "ADDomainName"}, "DomainDNSIPAddress": {"Ref": "DomainDNSIPAddress"}, "ADDirectoryID": {"Ref": "ADDirectoryID"}}}}, "WindowsInstance2": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "WindowsInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": {"Ref": "KeyName"}, "AvailabilityZone": {"Fn::Select": ["2", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "InstanceType", "Value": "Windows"}], "AdditionalProperties": {"ADDomainName": {"Ref": "ADDomainName"}, "DomainDNSIPAddress": {"Ref": "DomainDNSIPAddress"}, "ADDirectoryID": {"Ref": "ADDirectoryID"}}}}, "WindowsInstance3": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "WindowsInstanceType"}, "ImageId": "ami-0abcdef1234567890", "KeyName": {"Ref": "KeyName"}, "AvailabilityZone": {"Fn::Select": ["3", {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "InstanceType", "Value": "Windows"}], "AdditionalProperties": {"ADDomainName": {"Ref": "ADDomainName"}, "DomainDNSIPAddress": {"Ref": "DomainDNSIPAddress"}, "ADDirectoryID": {"Ref": "ADDirectoryID"}}}}}}