{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for setting up Aurora RDS as DMS Source, S3 as DMS Target, and configuring a DMS Replication Task.", "Resources": {"RDSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for RDS instance", "VpcId": {"Ref": "VPCId"}}}, "AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"DatabaseName": "SourceDB", "Engine": "aurora-mysql", "EngineMode": "provisioned", "DBClusterIdentifier": "aurora-cluster-demo", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "DBMasterPassword"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "RDSSecurityGroup"}]}}, "AuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceClass": "db.r4.large", "Engine": "aurora-mysql", "DBClusterIdentifier": {"Ref": "AuroraDBCluster"}}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet Group for RDS", "SubnetIds": ["subnet-12345", "subnet-67890"]}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "dms-target-bucket"}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.c4.large", "AllocatedStorage": 50}}, "SourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "source", "EngineName": "aurora-mysql", "Username": "admin", "Password": {"Ref": "DBMasterPassword"}, "ServerName": {"Fn::GetAtt": ["AuroraDBInstance", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "SourceDB"}}, "TargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationInstanceArn": {"Ref": "DMSReplicationInstance"}, "SourceEndpointArn": {"Ref": "SourceEndpoint"}, "TargetEndpointArn": {"Ref": "TargetEndpoint"}, "TableMappings": "{\"rules\":[{\"rule-type\":\"selection\",\"rule-id\":\"1\",\"rule-name\":\"1\",\"object-locator\":{\"schema-name\":\"%\",\"table-name\":\"%\"},\"rule-action\":\"include\"}]}"}}}, "Parameters": {"VPCId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC Id in which RDS and DMS instances will be placed"}, "DBMasterPassword": {"Type": "String", "Description": "The master user password for the Aurora DB cluster.", "NoEcho": "true"}}}