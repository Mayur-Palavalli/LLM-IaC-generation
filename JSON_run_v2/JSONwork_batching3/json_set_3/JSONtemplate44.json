{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true, "Tags": [{"Key": "Name", "Value": "VPC"}]}}, "Subnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}, "CidrBlock": "10.0.1.0/24", "MapPublicIpOnLaunch": true}}, "Subnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "AvailabilityZone": {"Fn::Select": [1, {"Fn::GetAZs": ""}]}, "CidrBlock": "10.0.2.0/24", "MapPublicIpOnLaunch": true}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnets for RDS DB", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "DBClusterIdentifier": "aurora-cluster", "MasterUsername": {"Ref": "DBMasterUsername"}, "MasterUserPassword": {"Ref": "DBMasterPassword"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Fn::GetAtt": ["DBSecGroup", "GroupId"]}], "EnableIAMDatabaseAuthentication": true}}, "AuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceClass": "db.r5.large", "Engine": "aurora-mysql", "DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "PubliclyAccessible": false}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {}}, "ReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnets for DMS", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "ReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.c5.large", "ReplicationSubnetGroupIdentifier": {"Ref": "ReplicationSubnetGroup"}, "VpcSecurityGroupIds": [{"Fn::GetAtt": ["DMSSecGroup", "GroupId"]}], "AllocatedStorage": 100}}, "SourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": {"Ref": "DBMasterUsername"}, "Password": {"Ref": "DBMasterPassword"}, "DatabaseName": "yourdatabasename", "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Port"]}}}, "TargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "target-endpoint", "EndpointType": "target", "EngineName": "s3", "BucketName": {"Ref": "S3Bucket"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationTaskIdentifier": "dms-migration-task", "SourceEndpointArn": {"Ref": "SourceEndpoint"}, "TargetEndpointArn": {"Ref": "TargetEndpoint"}, "ReplicationInstanceArn": {"Ref": "ReplicationInstance"}, "TableMappings": "{ \"TableMappings\": [] }", "ReplicationTaskSettings": "{}"}}, "DBSecGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for RDS", "VpcId": {"Ref": "VPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3306", "ToPort": "3306", "CidrIp": "0.0.0.0/0"}]}}, "DMSSecGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for DMS", "VpcId": {"Ref": "VPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "22", "ToPort": "22", "CidrIp": "0.0.0.0/0"}]}}}, "Parameters": {"DBMasterUsername": {"Type": "String", "Description": "The master username for the RDS instance."}, "DBMasterPassword": {"Type": "String", "Description": "The master password for the RDS instance.", "NoEcho": true}}}