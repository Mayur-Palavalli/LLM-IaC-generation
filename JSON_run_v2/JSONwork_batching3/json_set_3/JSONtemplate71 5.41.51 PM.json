{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for a Multi-AZ EFS with automount setup.", "Resources": {"EFSFileSystem": {"Type": "AWS::EFS::FileSystem", "Properties": {"PerformanceMode": "generalPurpose", "Encrypted": true, "LifecyclePolicies": [{"TransitionToIA": "AFTER_30_DAYS"}]}}, "EFSMountTarget1": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "EFSFileSystem"}, "SubnetId": "subnet-xxxxxx1", "SecurityGroups": [{"Ref": "SecurityGroup1"}]}}, "EFSMountTarget2": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "EFSFileSystem"}, "SubnetId": "subnet-xxxxxx2", "SecurityGroups": [{"Ref": "SecurityGroup2"}]}}, "EC2Instance": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t2.micro", "ImageId": "ami-xxxxxxxx", "KeyName": "MyKeyPair", "SecurityGroupIds": [{"Ref": "SecurityGroup1"}], "SubnetId": "subnet-xxxxxx1", "UserData": {"Fn::Base64": {"Fn::Join": ["", ["#!/bin/bash -xe\n", "yum install -y amazon-efs-utils\n", "yum install -y nfs-utils\n", "file-system-id=", {"Ref": "EFSFileSystem"}, "mount-point=/mnt/efs\n", "mkdir -p ${mount-point}\n", "mount -t efs ${file-system-id}:/ ${mount-point}\n", "echo '${file-system-id}:/ ${mount-point} efs defaults,_netdev 0 0' >> /etc/fstab\n"]]}}}}, "SecurityGroup1": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for EFS Mount target and EC2 instance in subnet 1", "VpcId": "vpc-xxxxxx"}}, "SecurityGroup2": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for EFS Mount target in subnet 2", "VpcId": "vpc-xxxxxx"}}}}