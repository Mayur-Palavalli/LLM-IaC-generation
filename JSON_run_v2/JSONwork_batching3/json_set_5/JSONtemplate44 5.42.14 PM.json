{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for a VPC with Aurora RDS, DMS and S3 setup.", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true}}, "SubnetA": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}}}, "AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"DatabaseName": "MyDatabase", "DBClusterIdentifier": "MyAuroraCluster", "Engine": "aurora-mysql", "MasterUsername": "masteruser", "MasterUserPassword": {"Ref": "MySecretPassword"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora", "SubnetIds": [{"Ref": "SubnetA"}]}}, "AuroraInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceClass": "db.t3.medium", "Engine": "aurora-mysql", "DBClusterIdentifier": {"Ref": "AuroraDBCluster"}}}, "MyBucket": {"Type": "AWS::S3::Bucket"}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t3.medium", "VpcSecurityGroupIds": [{"Fn::GetAtt": ["MyVPC", "DefaultSecurityGroup"]}]}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "source", "EngineName": "aurora-mysql", "DatabaseName": "MyDatabase", "Username": "masteruser", "Password": {"Ref": "MySecretPassword"}, "ServerName": {"Fn::GetAtt": ["AuroraInstance", "Endpoint.Address"]}, "Port": 3306}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketFolder": "DMS", "CompressionType": "None"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationInstanceArn": {"Ref": "DMSReplicationInstance"}, "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "TableMappings": "{\"selectionRules\":[{\"schemaName\":\"%\",\"tableFilter\":[{\"name\":\"%\"},{\"action\":\"include\"}]}]}"}}}, "Parameters": {"MySecretPassword": {"Type": "String", "NoEcho": "true"}}}