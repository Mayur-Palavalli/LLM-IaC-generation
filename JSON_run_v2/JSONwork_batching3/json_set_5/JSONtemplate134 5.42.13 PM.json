{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create a RDS DBInstance with snapshot on stack deletion.", "Resources": {"MyDBInstance": {"Type": "AWS::RDS::DBInstance", "DeletionPolicy": "Snapshot", "UpdateReplacePolicy": "Snapshot", "Properties": {"DBInstanceClass": "db.t3.micro", "AllocatedStorage": "20", "Engine": "MySQL", "MasterUsername": "adminuser", "MasterUserPassword": {"Ref": "DBPasswordSecret"}, "DBSnapshotIdentifier": {"Fn::If": ["UseSnapshot", {"Ref": "SnapshotName"}, {"Ref": "AWS::NoValue"}]}}}}, "Parameters": {"SnapshotName": {"Description": "Name of snapshot to use for database restoration. Use only if you are restoring from an existing snapshot.", "Type": "String", "Default": "", "AllowedPattern": "[a-zA-Z0-9]*", "ConstraintDescription": "must consist of alphanumeric characters only"}, "DBPasswordSecret": {"Description": "The ARN of the secret containing the database administrator password", "Type": "String"}}, "Conditions": {"UseSnapshot": {"Fn::Not": [{"Fn::Equals": [{"Ref": "SnapshotName"}, ""]}]}}}