{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to deploy two EC2 instances behind a load balancer.", "Parameters": {"VPCId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID where resources will be created."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "List of Subnet IDs for the EC2 instances and load balancer."}, "InstanceType": {"Type": "String", "Default": "t2.micro", "Description": "EC2 instance type."}, "KeyName": {"Type": "AWS::EC2::KeyPair::KeyName", "Description": "Key pair for SSH access to EC2 instances."}, "SSHLocation": {"Type": "String", "Default": "0.0.0.0/0", "Description": "The IP address range that can be used to SSH to the EC2 instances."}}, "Resources": {"EC2SecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for EC2 instances allowing ports 80 and 8888", "VpcId": {"Ref": "VPCId"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 8888, "ToPort": 8888, "CidrIp": "0.0.0.0/0"}, {"IpProtocol": "tcp", "FromPort": 22, "ToPort": 22, "CidrIp": {"Ref": "SSHLocation"}}]}}, "LoadBalancerSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for load balancer allowing port 80", "VpcId": {"Ref": "VPCId"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 80, "ToPort": 80, "CidrIp": "0.0.0.0/0"}]}}, "LoadBalancer": {"Type": "AWS::ElasticLoadBalancingV2::LoadBalancer", "Properties": {"Subnets": {"Ref": "SubnetIds"}, "SecurityGroups": [{"Ref": "LoadBalancerSecurityGroup"}]}}, "TargetGroup": {"Type": "AWS::ElasticLoadBalancingV2::TargetGroup", "Properties": {"Port": 80, "Protocol": "HTTP", "VpcId": {"Ref": "VPCId"}, "HealthCheckPath": "/", "HealthCheckPort": "traffic-port", "HealthCheckProtocol": "HTTP", "TargetType": "instance"}}, "Listener": {"Type": "AWS::ElasticLoadBalancingV2::Listener", "Properties": {"DefaultActions": [{"Type": "forward", "TargetGroupArn": {"Ref": "TargetGroup"}}], "LoadBalancerArn": {"Ref": "LoadBalancer"}, "Port": 80, "Protocol": "HTTP"}}, "EC2Instance1": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "InstanceType"}, "SecurityGroups": [{"Ref": "EC2SecurityGroup"}], "KeyName": {"Ref": "KeyName"}, "ImageId": "ami-0c55b159cbfafe1f0", "SubnetId": {"Fn::Select": [0, {"Ref": "SubnetIds"}]}}}, "EC2Instance2": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": {"Ref": "InstanceType"}, "SecurityGroups": [{"Ref": "EC2SecurityGroup"}], "KeyName": {"Ref": "KeyName"}, "ImageId": "ami-0c55b159cbfafe1f0", "SubnetId": {"Fn::Select": [1, {"Ref": "SubnetIds"}]}}}}, "Outputs": {"LoadBalancerDNSName": {"Description": "DNS Name of the load balancer", "Value": {"Fn::GetAtt": ["LoadBalancer", "DNSName"]}}}}