{"AWSTemplateFormatVersion": "2010-09-09", "Description": "CloudFormation template for Aurora RDS, DMS, and S3.", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true}}, "MyRDSSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnets available for the Aurora RDS instance", "SubnetIds": ["subnet-1a2b3c4d", "subnet-4d3c2b1a"]}}, "MyAuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "DBSubnetGroupName": {"Ref": "MyRDSSubnetGroup"}, "MasterUsername": "AuroraAdmin", "MasterUserPassword": {"Fn::Sub": "{{resolve:ssm-secure:DBPassword:1}}"}}}, "MyDMSRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "dms.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "DMSAccessForS3Bucket", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["s3:PutObject", "s3:DeleteObject"], "Resource": {"Fn::GetAtt": ["MyS3Bucket", "Arn"]}}]}}]}}, "MyS3Bucket": {"Type": "AWS::S3::Bucket", "DeletionPolicy": "Retain", "UpdateReplacePolicy": "Retain"}, "MyReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.c4.large", "VpcSecurityGroupIds": ["sg-123456"], "ReplicationSubnetGroupIdentifier": {"Ref": "MyDMSSubnetGroup"}, "PubliclyAccessible": true}}, "MyDMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnets available for the DMS instance", "SubnetIds": ["subnet-1a2b3c4d", "subnet-4d3c2b1a"]}}, "MySourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "source", "EngineName": "aurora-mysql", "Username": "AuroraAdmin", "Password": {"Fn::Sub": "{{resolve:ssm-secure:DBPassword:1}}"}, "ServerName": {"Fn::GetAtt": ["MyAuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "MyDatabase"}}, "MyTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketFolder": "dms-target", "BucketName": {"Ref": "MyS3Bucket"}, "CompressionType": "gzip"}}}, "MyDMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationTaskIdentifier": "MigrateAuroraToS3", "SourceEndpointArn": {"Ref": "MySourceEndpoint"}, "TargetEndpointArn": {"Ref": "MyTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "ReplicationInstanceArn": {"Ref": "MyReplicationInstance"}, "TableMappings": "{\"rules\": [{\"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": {\"schema-name\": \"%\", \"table-name\": \"%\"}, \"rule-action\": \"include\"}]}"}}}}