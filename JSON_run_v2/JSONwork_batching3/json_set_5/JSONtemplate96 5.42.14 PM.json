{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for a load balanced, auto-scaled website, accepting traffic only from the load balancer.", "Resources": {"WebServerSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for web server instances to only allow traffic from the Load Balancer", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 8888, "ToPort": 8888, "SourceSecurityGroupId": {"Ref": "LoadBalancerSecurityGroup"}}]}}, "LoadBalancerSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Load Balancer security group.", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 80, "ToPort": 80, "CidrIp": "0.0.0.0/0"}]}}, "LoadBalancer": {"Type": "AWS::ElasticLoadBalancing::LoadBalancer", "Properties": {"Listeners": [{"LoadBalancerPort": 80, "InstancePort": 8888, "Protocol": "HTTP"}], "HealthCheck": {"Target": "HTTP:8888/", "HealthyThreshold": 3, "UnhealthyThreshold": 5, "Interval": 30, "Timeout": 5}, "SecurityGroups": [{"Ref": "LoadBalancerSecurityGroup"}], "Subnets": {"Ref": "Subnets"}}}, "AutoScalingGroup": {"Type": "AWS::AutoScaling::AutoScalingGroup", "Properties": {"AvailabilityZones": {"Fn::GetAZs": {"Ref": "AWS::Region"}}, "LaunchConfigurationName": {"Ref": "LaunchConfig"}, "MinSize": 1, "MaxSize": 3, "LoadBalancerNames": [{"Ref": "LoadBalancer"}], "VPCZoneIdentifier": {"Ref": "Subnets"}, "HealthCheckType": "ELB", "HealthCheckGracePeriod": 300}}, "LaunchConfig": {"Type": "AWS::AutoScaling::LaunchConfiguration", "Properties": {"ImageId": "ami-0123456789abcdef0", "InstanceType": "t2.micro", "SecurityGroups": [{"Ref": "WebServerSecurityGroup"}], "UserData": {"Fn::Base64": {"Fn::Join": ["", ["#!/bin/bash\n", "yum install -y httpd\n", "echo '<html><head><title>AWS CloudFormation Sample</title></head><body><h1>Welcome to the AWS CloudFormation Sample Site</h1></body></html>' > /var/www/html/index.html", "service httpd start\n", "chkconfig httpd on"]]}}}}, "Subnets": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::GetAZs": ""}}}, "VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": "true", "EnableDnsHostnames": "true"}}}}