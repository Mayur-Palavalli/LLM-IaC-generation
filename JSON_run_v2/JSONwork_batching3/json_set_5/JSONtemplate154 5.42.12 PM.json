{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for AD Connector and related resources.", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The VPC ID where the resources will be deployed."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "Subnet IDs for the AD Connector."}, "OnPremDirectoryDNS": {"Type": "String", "Description": "Comma separated IPs for on-premises Directory DNS servers."}, "OnPremDirectoryNetBIOSName": {"Type": "String", "Description": "NetBIOS name of the on-premises domain."}, "ServiceAccountPassword": {"Type": "String", "Description": "The password for the service account.", "NoEcho": "True"}, "CreateSeamlessDomainJoinResources": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Specify whether to create seamless domain join resources for EC2 instances."}, "CreateSecurityGroup": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Specify whether to create a Domain Members Security Group."}, "CreateDHCPOptions": {"Type": "String", "AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Specify whether to create DHCP option set for Domain DNS."}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::SimpleAD", "Properties": {"Name": {"Ref": "OnPremDirectoryNetBIOSName"}, "Password": {"Ref": "ServiceAccountPassword"}, "Size": "Small", "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "SeamlessDomainJoin": {"Type": "AWS::DirectoryService::MicrosoftAD", "Condition": "CreateSeamlessDomainJoin", "Properties": {"Name": {"Ref": "OnPremDirectoryNetBIOSName"}, "Password": {"Ref": "ServiceAccountPassword"}, "Edition": "Standard", "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "DomainMembersSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Condition": "CreateSecurityGroup", "Properties": {"GroupDescription": "Allow all Private IP inbound traffic", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/8"}, {"IpProtocol": "-1", "CidrIp": "172.16.0.0/12"}, {"IpProtocol": "-1", "CidrIp": "192.168.0.0/16"}]}}, "DHCPDomainOptionsSet": {"Type": "AWS::EC2::DHCPOptions", "Condition": "CreateDHCPOptions", "Properties": {"DomainNameServers": {"Fn::Split": [",", {"Ref": "OnPremDirectoryDNS"}]}, "Tags": [{"Key": "Name", "Value": "Domain DHCP Option Set"}]}}}, "Conditions": {"CreateSeamlessDomainJoin": {"Fn::Equals": [{"Ref": "CreateSeamlessDomainJoinResources"}, "Yes"]}, "CreateSecurityGroup": {"Fn::Equals": [{"Ref": "CreateSecurityGroup"}, "Yes"]}, "CreateDHCPOptions": {"Fn::Equals": [{"Ref": "CreateDHCPOptions"}, "Yes"]}}}