{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for AWS IoT Analytics with Channel, Datastore, Pipeline, and DataSet with an SQL action.", "Resources": {"IoTAnalyticsChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "IoTAnalyticsChannel", "RetentionPeriod": {"NumberOfDays": 1, "Unlimited": false}}}, "IoTAnalyticsDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "IoTAnalyticsDatastore", "RetentionPeriod": {"NumberOfDays": 1, "Unlimited": false}}}, "IoTAnalyticsPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "IoTAnalyticsPipeline", "PipelineActivities": [{"Channel": {"Name": "SourceChannel", "ChannelName": {"Ref": "IoTAnalyticsChannel"}, "Next": "DatastoreActivity"}}, {"Datastore": {"Name": "DatastoreActivity", "DatastoreName": {"Ref": "IoTAnalyticsDatastore"}}}]}}, "IoTAnalyticsDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "IoTAnalyticsDataset", "Actions": [{"ActionName": "QueryAction", "QueryAction": {"SqlQuery": {"Fn::Sub": "SELECT * FROM ${IoTAnalyticsDatastore}"}, "Filters": [{"DeltaTime": {"OffsetSeconds": 60, "TimeExpression": "$$creationtime"}}]}}], "Triggers": [{"Schedule": {"ScheduleExpression": "rate(1 day)"}}], "RetentionPeriod": {"Unlimited": true}}}}}