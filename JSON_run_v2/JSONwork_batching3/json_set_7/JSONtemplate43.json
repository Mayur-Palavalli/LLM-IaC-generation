{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "EngineMode": "serverless", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "DBMasterPassword"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for Aurora RDS instance", "VpcId": {"Ref": "VPC"}}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora RDS instance", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "dms-target-bucket"}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for DMS instance", "VpcId": {"Ref": "VPC"}}}, "DMSInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t2.micro", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSReplicationSubnetGroup"}}}, "DMSReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupIdentifier": "dms-replication-subnet-group", "ReplicationSubnetGroupDescription": "Subnet group for DMS instance", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Ref": "DBSourcePassword"}, "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "target-endpoint", "EndpointType": "target", "EngineName": "s3"}}, "DMSRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "dms.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "DMSAccessPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["s3:*"], "Resource": [{"Fn::GetAtt": ["S3Bucket", "Arn"]}]}]}}]}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationTaskIdentifier": "dms-task", "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "TableMappings": "{\"table-mappings\": {\"rules\": [{\"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": {\"schema-name\": \"%\", \"table-name\": \"%\"}, \"rule-action\": \"include\"}]}}", "ReplicationTaskSettings": "{\"FullLoadSettings\": {\"TargetTablePrepMode\": \"DROP_AND_CREATE\",\"MaxFullLoadSubTasks\": 8}}", "ReplicationInstanceArn": {"Ref": "DMSInstance"}}}, "VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16"}}, "Subnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.0.0/24"}}, "Subnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24"}}}, "Parameters": {"DBMasterPassword": {"Type": "AWS::SSM::Parameter::Value<String>", "Description": "The password for the master DB user", "Default": "/myapp/prod/db-master-password"}, "DBSourcePassword": {"Type": "AWS::SSM::Parameter::Value<String>", "Description": "The password for the source DB user", "Default": "/myapp/prod/db-source-password"}}}