{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for AD Connector and accompanying resources.", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID"}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "Subnet IDs for AD Connector"}, "CustomerDnsIps": {"Type": "List<String>", "Description": "DNS IPs of the on-premises directory"}, "DomainName": {"Type": "String", "Description": "Domain name of the on-premises directory"}, "ADConnectorPassword": {"Type": "AWS::SecretsManager::Secret", "Description": "Password for AD Connector", "NoEcho": true}, "CreateDomainMembersSecurityGroup": {"Type": "String", "AllowedValues": ["true", "false"], "Description": "Create Security Group for domain members"}, "CreateDHCPOptionSet": {"Type": "String", "AllowedValues": ["true", "false"], "Description": "Create DHCP Option Set"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "DomainName"}, "Password": {"Fn::Sub": "{{resolve:secretsmanager:${ADConnectorPassword}}}"}, "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "DomainMembersSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VpcId"}, "GroupDescription": "Security group for domain members with unrestricted intra-group traffic", "SecurityGroupIngress": [{"IpProtocol": "-1", "SourceSecurityGroupId": {"Fn::ImportValue": "ExternalSecurityGroupId"}}]}, "Condition": "CreateDomainMembersSecurityGroup"}, "DHCPOptions": {"Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "DomainName"}, "DomainNameServers": {"Ref": "CustomerDnsIps"}}, "Condition": "CreateDHCPOptionSet"}, "DHCPOptionsAssociation": {"Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"DhcpOptionsId": {"Ref": "DHCPOptions"}, "VpcId": {"Ref": "VpcId"}}, "Condition": "CreateDHCPOptionSet"}}, "Conditions": {"CreateDomainMembersSecurityGroup": {"Fn::Equals": [{"Ref": "CreateDomainMembersSecurityGroup"}, "true"]}, "CreateDHCPOptionSet": {"Fn::Equals": [{"Ref": "CreateDHCPOptionSet"}, "true"]}}}