{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Template to create an Amazon EKS Cluster on EC2", "Parameters": {"ClusterName": {"Type": "String", "Description": "The name of the EKS Cluster", "Default": "MyEKSCluster"}, "NodeInstanceType": {"Type": "String", "Description": "EC2 instance type for the EKS worker nodes", "Default": "t3.medium", "AllowedValues": ["t2.micro", "t2.small", "t2.medium", "t3.micro", "t3.small", "t3.medium", "m3.medium", "m3.large", "m3.xlarge", "m3.2xlarge", "m4.large", "m4.xlarge", "m4.2xlarge", "m4.4xlarge", "m4.10xlarge", "m5.large", "m5.xlarge", "m5.2xlarge", "m5.4xlarge", "m5.12xlarge", "m5.24xlarge", "c4.large", "c4.xlarge", "c4.2xlarge", "c4.4xlarge", "c4.8xlarge", "c5.large", "c5.xlarge", "c5.2xlarge", "c5.4xlarge", "c5.9xlarge", "c5.18xlarge"], "ConstraintDescription": "must be a valid EC2 instance type."}, "KeyName": {"Type": "AWS::EC2::KeyPair::KeyName", "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances"}, "Subnets": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "Subnets to use for the EKS cluster"}}, "Resources": {"EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": {"Ref": "ClusterName"}, "ResourcesVpcConfig": {"SubnetIds": {"Ref": "Subnets"}}, "RoleArn": {"Fn::GetAtt": ["NodeGroupRole", "Arn"]}}}, "NodeGroupRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy", "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly", "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy"], "RoleName": {"Fn::Sub": "${ClusterName}-NodeGroupRole"}}}, "NodeGroup": {"Type": "AWS::EKS::Nodegroup", "Properties": {"ClusterName": {"Ref": "EKSCluster"}, "NodeRole": {"Fn::GetAtt": ["NodeGroupRole", "Arn"]}, "Subnets": {"Ref": "Subnets"}, "InstanceTypes": [{"Ref": "NodeInstanceType"}], "ScalingConfig": {"MinSize": 1, "MaxSize": 3, "DesiredSize": 2}, "AmiType": "AL2_x86_64", "DiskSize": 20, "RemoteAccess": {"Ec2SshKey": {"Ref": "KeyName"}}}}}, "Outputs": {"ClusterName": {"Description": "Name of the EKS Cluster", "Value": {"Ref": "EKSCluster"}}, "NodeInstanceRole": {"Description": "Role of the EKS NodeGroup", "Value": {"Ref": "NodeGroupRole"}}}}