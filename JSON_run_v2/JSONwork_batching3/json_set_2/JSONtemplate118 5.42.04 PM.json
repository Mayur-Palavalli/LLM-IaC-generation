{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for IoT Analytics components including Channel, Datastore, Pipeline, and Dataset with SQL Action.", "Resources": {"MyChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "MyIoTAnalyticsChannel"}}, "MyDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "MyIoTAnalyticsDatastore"}}, "MyPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "MyIoTAnalyticsPipeline", "PipelineActivities": [{"ChannelActivity": {"Name": "ExtractChannelData", "ChannelName": {"Ref": "MyChannel"}, "Next": "DatastoreData"}}, {"DatastoreActivity": {"Name": "DatastoreData", "DatastoreName": {"Ref": "MyDatastore"}}}]}}, "MyDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "MyIoTAnalyticsDataset", "Actions": [{"ActionName": "QueryDatastore", "QueryAction": {"SqlQuery": "SELECT * FROM MyIoTAnalyticsDatastore", "Filters": [{"DeltaTime": {"OffsetSeconds": 60, "TimeExpression": "$$__time"}}]}}], "Triggers": [{"Schedule": {"Expression": "rate(5 minutes)"}}], "ContentDeliveryRules": [{"EntryName": "DailyS3Export", "Destination": {"IotAnalyticsDestination": {"BucketName": "MyIoTAnalyticsBucket", "Key": "daily_data_export/${timestamp()}"}}, "Format": "JSON"}]}}}}