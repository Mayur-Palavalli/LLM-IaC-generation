{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"TableConfigIteration": {"Type": "Custom::TableConfigIteration", "Properties": {"ServiceToken": {"Fn::GetAtt": ["TableConfigFunction", "Arn"]}, "TableConfigurations": [{"TableName": "Table1", "AttributeDefinitions": [{"AttributeName": "Id", "AttributeType": "S"}], "KeySchema": [{"AttributeName": "Id", "KeyType": "HASH"}], "ProvisionedThroughput": {"ReadCapacityUnits": 5, "WriteCapacityUnits": 5}}, {"TableName": "Table2", "AttributeDefinitions": [{"AttributeName": "UserId", "AttributeType": "S"}], "KeySchema": [{"AttributeName": "UserId", "KeyType": "HASH"}], "ProvisionedThroughput": {"ReadCapacityUnits": 5, "WriteCapacityUnits": 5}}, {"TableName": "Table3", "AttributeDefinitions": [{"AttributeName": "OrderId", "AttributeType": "S"}], "KeySchema": [{"AttributeName": "OrderId", "KeyType": "HASH"}], "ProvisionedThroughput": {"ReadCapacityUnits": 5, "WriteCapacityUnits": 5}}]}}, "TableConfigFunction": {"Type": "AWS::Lambda::Function", "Properties": {"Handler": "index.handler", "Role": {"Fn::GetAtt": ["LambdaExecutionRole", "Arn"]}, "Code": {"ZipFile": {"Fn::Join": ["\n", ["const AWS = require('aws-sdk');", "const dynamodb = new AWS.DynamoDB();", "exports.handler = async function(event, context) {", "  const tableConfigs = event.TableConfigurations;", "  const createTablePromises = tableConfigs.map(config =>", "    dynamodb.createTable(config).promise()", "  );", "  await Promise.all(createTablePromises);", "  return 'Tables created successfully';", "};"]]}}, "Runtime": "nodejs20.x"}}, "LambdaExecutionRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "lambda.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "LambdaDynamoDBPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["dynamodb:CreateTable", "dynamodb:DescribeTable", "dynamodb:UpdateTable", "dynamodb:DeleteTable"], "Resource": "*"}]}}]}}}}