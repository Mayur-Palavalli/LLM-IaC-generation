{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template that launches an EC2 instance with cfn-init and cfn-signal support.", "Parameters": {"KeyName": {"Description": "Name of an existing EC2 KeyPair to enable SSH access to the instance", "Type": "AWS::EC2::KeyPair::KeyName", "ConstraintDescription": "Must be the name of an existing EC2 KeyPair."}, "InstanceType": {"Description": "EC2 instance type", "Type": "String", "Default": "t2.micro", "AllowedValues": ["t1.micro", "t2.micro", "t2.small", "t2.medium", "t2.large"], "ConstraintDescription": "Must be a valid EC2 instance type."}, "AMI": {"Description": "The AMI ID for the instance", "Type": "AWS::EC2::Image::Id"}}, "Resources": {"MyInstance": {"Type": "AWS::EC2::Instance", "Metadata": {"AWS::CloudFormation::Init": {"config": {"packages": {"yum": {"httpd": []}}, "services": {"sysvinit": {"httpd": {"enabled": "true", "ensureRunning": "true"}}}, "files": {"/var/www/html/index.html": {"content": "Welcome to your CFN-init deployed web server!", "mode": "000644", "owner": "root", "group": "root"}}}}}, "Properties": {"KeyName": {"Ref": "KeyName"}, "InstanceType": {"Ref": "InstanceType"}, "ImageId": {"Ref": "AMI"}, "UserData": {"Fn::Base64": {"Fn::Sub": ["#!/bin/bash -xe\nyum update -y aws-cfn-bootstrap\n/opt/aws/bin/cfn-init -v --stack ${AWS::StackName} --resource MyInstance --region ${AWS::Region}\n/opt/aws/bin/cfn-signal -e $? --stack ${AWS::StackName} --resource MyInstance --region ${AWS::Region}", {"AWS::StackName": {"Ref": "AWS::StackName"}, "AWS::Region": {"Ref": "AWS::Region"}}]}}, "CreationPolicy": {"ResourceSignal": {"Timeout": "PT15M"}}}}}, "Outputs": {"InstanceId": {"Description": "The Instance ID of the EC2 instance", "Value": {"Ref": "MyInstance"}}, "PublicDNS": {"Description": "The public DNS name of the EC2 instance", "Value": {"Fn::GetAtt": ["MyInstance", "PublicDnsName"]}}}}