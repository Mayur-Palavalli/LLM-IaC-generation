{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "DBMasterPassword"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}]}}, "DBInstance1": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "DBInstanceClass": "db.r5.large", "Engine": "aurora"}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "dms-target-bucket"}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupName": "DBSecurityGroup", "GroupDescription": "Security group for Aurora DB cluster", "VpcId": {"Ref": "VPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3306", "ToPort": "3306", "CidrIp": "0.0.0.0/0"}]}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora DB cluster", "SubnetIds": [{"Ref": "SubnetA"}, {"Ref": "SubnetB"}]}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Ref": "DBMasterPassword"}, "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}, "CompressionType": "GZIP"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationTaskIdentifier": "aurora-to-s3-replication", "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "TableMappings": "{\"rules\":[{\"rule-type\":\"selection\",\"rule-id\":\"1\",\"rule-name\":\"1\",\"object-locator\":{\"schema-name\":\"%\",\"table-name\":\"%\"},\"rule-action\":\"include\"}]}", "ReplicationTaskSettings": "{\"TargetMetadata\":{\"TargetSchema\":{\"SchemaName\":\"\",\"TrimSpaceInChar\":true,\"SupportLobs\":true,\"FullLobMode\":true}}}"}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.c5.large", "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnet group for DMS Replication Instance", "SubnetIds": [{"Ref": "SubnetA"}, {"Ref": "SubnetB"}]}}}, "Parameters": {"DBMasterPassword": {"Type": "String", "NoEcho": true}, "VPC": {"Type": "AWS::EC2::VPC::Id"}, "SubnetA": {"Type": "AWS::EC2::Subnet::Id"}, "SubnetB": {"Type": "AWS::EC2::Subnet::Id"}}}