{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for a secure S3 bucket with replication and access logging.", "Resources": {"PrimaryBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "LoggingConfiguration": {"DestinationBucketName": {"Ref": "LogBucket"}, "LogFilePrefix": "primary/"}, "VersioningConfiguration": {"Status": "Enabled"}}}, "ReplicaBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketEncryption": {"ServerSideEncryptionConfiguration": [{"ServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}, "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}, "VersioningConfiguration": {"Status": "Enabled"}}}, "LogBucket": {"Type": "AWS::S3::Bucket", "Properties": {"AccessControl": "LogDeliveryWrite", "PublicAccessBlockConfiguration": {"BlockPublicAcls": true, "IgnorePublicAcls": true, "BlockPublicPolicy": true, "RestrictPublicBuckets": true}}}, "PrimaryBucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Properties": {"Bucket": {"Ref": "PrimaryBucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Sid": "RequireSecureTransport", "Effect": "Deny", "Principal": "*", "Action": "s3:*", "Resource": {"Fn::Sub": ["arn:aws:s3:::${bucketName}/*", {"bucketName": {"Ref": "PrimaryBucket"}}]}, "Condition": {"Bool": {"aws:SecureTransport": "false"}}}]}}}, "ReplicaBucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Properties": {"Bucket": {"Ref": "ReplicaBucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Sid": "RequireSecureTransport", "Effect": "Deny", "Principal": "*", "Action": "s3:*", "Resource": {"Fn::Sub": ["arn:aws:s3:::${bucketName}/*", {"bucketName": {"Ref": "ReplicaBucket"}}]}, "Condition": {"Bool": {"aws:SecureTransport": "false"}}}]}}}}, "Outputs": {"PrimaryBucketName": {"Description": "Name of the primary S3 bucket", "Value": {"Ref": "PrimaryBucket"}}, "ReplicaBucketName": {"Description": "Name of the replica S3 bucket", "Value": {"Ref": "ReplicaBucket"}}, "LogBucketName": {"Description": "Name of the S3 bucket for logs", "Value": {"Ref": "LogBucket"}}}}