{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Template to create an AD Connector and associated resources for seamless domain join and networking.", "Parameters": {"VPCId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID where AD Connector will reside"}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "Subnet IDs for the AD Connector deployment"}, "OnPremisesDNSIpAddresses": {"Type": "List<String>", "Description": "List of DNS IP addresses of the on-premises domain controllers"}, "DomainName": {"Type": "String", "Description": "The fully qualified domain name (FQDN) of the on-premises directory"}, "ServiceAccountUsername": {"Type": "String", "Description": "The user name for the service account on your on-premises directory"}, "ServiceAccountPassword": {"Type": "String", "Description": "The password for your service account on your on-premises directory", "NoEcho": true}, "CreateSeamlessDomainJoinResources": {"Type": "String", "AllowedValues": ["yes", "no"], "Default": "no", "Description": "Whether to create resources for Seamless Domain Join for EC2 instances"}, "CreateDomainMembersSecurityGroup": {"Type": "String", "AllowedValues": ["yes", "no"], "Default": "no", "Description": "Whether to create a security group for domain members with inbound rule for PrivateIP communications"}, "CreateDHCPoptionsSet": {"Type": "String", "AllowedValues": ["yes", "no"], "Default": "no", "Description": "Whether to create a DHCP options set pointing to the domain DNS servers"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::ADConnector", "Properties": {"Name": {"Ref": "DomainName"}, "Password": {"Ref": "ServiceAccountPassword"}, "Size": "Small", "ConnectSettings": {"VpcId": {"Ref": "VPCId"}, "SubnetIds": {"Ref": "SubnetIds"}, "CustomerDnsIps": {"Ref": "OnPremisesDNSIpAddresses"}}, "ConnectivityType": "ADConnector"}}, "SeamlessDomainJoinResources": {"Condition": "CreateSeamlessResources", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for Seamless Domain Join EC2 instances", "VpcId": {"Ref": "VPCId"}}}, "DomainMembersSecurityGroup": {"Condition": "CreateDomainMembersSG", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for domain member communication", "VpcId": {"Ref": "VPCId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "FromPort": 0, "ToPort": 0, "CidrIp": "VPC CIDR"}]}}, "DHCPoptionsSet": {"Condition": "CreateDHCPoptions", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "DomainName"}, "DomainNameServers": {"Ref": "OnPremisesDNSIpAddresses"}}}, "Conditions": {"CreateSeamlessResources": {"Fn::Equals": [{"Ref": "CreateSeamlessDomainJoinResources"}, "yes"]}, "CreateDomainMembersSG": {"Fn::Equals": [{"Ref": "CreateDomainMembersSecurityGroup"}, "yes"]}, "CreateDHCPoptions": {"Fn::Equals": [{"Ref": "CreateDHCPoptionsSet"}, "yes"]}}}}