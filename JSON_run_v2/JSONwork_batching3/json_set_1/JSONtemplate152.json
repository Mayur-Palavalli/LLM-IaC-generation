{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create AD Connector, seamless domain join, security group, and DHCP options.", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "ID of the VPC where AD Connector and resources will be deployed."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "List of Subnet IDs for AD Connector."}, "ADConnectorName": {"Type": "String", "Description": "Name of the AD Connector."}, "ServerDNSIPs": {"Type": "List<String>", "Description": "A list of one or more IP addresses of DNS servers in the on-premises directory."}, "Username": {"Type": "String", "Description": "Username of an account in the on-premises directory with sufficient privileges to join instances to the domain.", "NoEcho": true}, "Password": {"Type": "String", "Description": "Password of the account specified in Username.", "NoEcho": true}, "DomainDNSName": {"Type": "String", "Description": "Fully qualified domain name of the on-premises directory."}, "DomainName": {"Type": "String", "Description": "Short name of the on-premises directory, for example, CORP."}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "ADConnectorName"}, "Password": {"Ref": "Password"}, "Size": "Large", "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "SubnetIds"}}, "ConnectSettings": {"CustomerUserName": {"Ref": "Username"}, "ConnectIps": {"Ref": "ServerDNSIPs"}, "CustomerDnsIps": {"Ref": "ServerDNSIPs"}}}}, "SeamlessDomainJoinWindows": {"Condition": "CreateSeamlessDomainJoin", "Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "Parameters": {"directoryId": [{"Ref": "ADConnector"}], "directoryName": [{"Ref": "DomainDNSName"}], "dnsIpAddresses": {"Ref": "ServerDNSIPs"}}, "Targets": [{"Key": "tag:Platform", "Values": ["Windows"]}]}}, "SeamlessDomainJoinLinux": {"Condition": "CreateSeamlessDomainJoin", "Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "Parameters": {"directoryId": [{"Ref": "ADConnector"}], "directoryName": [{"Ref": "DomainDNSName"}], "dnsIpAddresses": {"Ref": "ServerDNSIPs"}}, "Targets": [{"Key": "tag:Platform", "Values": ["Linux"]}]}}, "DomainMembersSecurityGroup": {"Condition": "CreateDomainMembersSecurityGroup", "Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VpcId"}, "GroupDescription": "Security group for domain members.", "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "0.0.0.0/0"}], "Tags": [{"Key": "Name", "Value": "DomainMembersSecurityGroup"}]}}, "DHCPOptionSet": {"Condition": "CreateDHCPOptionSet", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "DomainDNSName"}, "DomainNameServers": {"Ref": "ServerDNSIPs"}}}}, "Conditions": {"CreateSeamlessDomainJoin": {"Fn::Or": [{"Fn::Not": [{"Fn::Equals": [{"Ref": "SeamlessDomainJoinEnabled"}, ""]}]}, {"Fn::Equals": [{"Ref": "SeamlessDomainJoinEnabled"}, "true"]}]}, "CreateDomainMembersSecurityGroup": {"Fn::Equals": [{"Ref": "CreateSecurityGroup"}, "true"]}, "CreateDHCPOptionSet": {"Fn::Equals": [{"Ref": "CreateDHCPOptionSet"}, "true"]}}}