{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create resources for an AD Connector connecting to an on-premises directory.", "Parameters": {"DirectoryName": {"Type": "String", "Description": "The name of the directory."}, "Size": {"Type": "String", "AllowedValues": ["Small", "Large"], "Description": "The size of the AD Connector."}, "VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The ID of the VPC where the AD Connector will reside."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "The subnet IDs for the AD Connector."}, "CreateSeamlessDomainJoinResources": {"Type": "String", "Default": "No", "AllowedValues": ["Yes", "No"], "Description": "Option to create seamless domain join resources for EC2 instances."}, "CreateSecurityGroup": {"Type": "String", "Default": "No", "AllowedValues": ["Yes", "No"], "Description": "Option to create a domain members security group."}, "CreateDHCPOptions": {"Type": "String", "Default": "No", "AllowedValues": ["Yes", "No"], "Description": "Option to create DHCP options set pointing to domain DNS servers."}, "DHCPIPAddresses": {"Type": "CommaDelimitedList", "Description": "Comma-separated list of domain DNS server IP addresses for DHCP options set, required if CreateDHCPOptions is Yes."}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::SimpleAD", "Properties": {"Name": {"Ref": "DirectoryName"}, "Password": {"Fn::GetAtt": ["ADConnectorSecret", "SecretString"]}, "Size": {"Ref": "Size"}, "VpcSettings": {"VpcId": {"Ref": "VpcId"}, "SubnetIds": {"Ref": "SubnetIds"}}}}, "ADConnectorSecret": {"Type": "AWS::SecretsManager::Secret", "Properties": {"Name": "adconnectorpassword", "Description": "Password for AD Connector"}}, "SeamlessDomainJoinResources": {"Condition": "CreateSeamlessDomainJoin", "DependsOn": "ADConnector", "Type": "AWS::SSM::Document", "Properties": {"Content": "INSERT_DOCUMENT_CONTENT_HERE", "DocumentType": "Command"}}, "DomainMembersSecurityGroup": {"Condition": "CreateSecurityGroup", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for domain members allowing all private IP communications inbound.", "VpcId": {"Ref": "VpcId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/8"}, {"IpProtocol": "-1", "CidrIp": "172.16.0.0/12"}, {"IpProtocol": "-1", "CidrIp": "192.168.0.0/16"}]}}, "DHCPOptionSet": {"Condition": "CreateDHCPOptions", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainNameServers": {"Ref": "DHCPIPAddresses"}}}}, "Conditions": {"CreateSeamlessDomainJoin": {"Fn::Equals": [{"Ref": "CreateSeamlessDomainJoinResources"}, "Yes"]}, "CreateSecurityGroup": {"Fn::Equals": [{"Ref": "CreateSecurityGroup"}, "Yes"]}, "CreateDHCPOptions": {"Fn::Equals": [{"Ref": "CreateDHCPOptions"}, "Yes"]}}, "Outputs": {"ADConnectorId": {"Description": "The ID of the AD Connector.", "Value": {"Ref": "ADConnector"}}, "SecurityGroupId": {"Condition": "CreateSecurityGroup", "Description": "The ID of the domain members security group.", "Value": {"Ref": "DomainMembersSecurityGroup"}}, "DHCPOptionsId": {"Condition": "CreateDHCPOptions", "Description": "The ID of the DHCP options set.", "Value": {"Ref": "DHCPOptionSet"}}}}