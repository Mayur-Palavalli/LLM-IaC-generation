{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template with two EC2 instances behind a load balancer with a simple health check.", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true}}, "MyInternetGateway": {"Type": "AWS::EC2::InternetGateway"}, "GatewayAttachment": {"Type": "AWS::EC2::VPCGatewayAttachment", "Properties": {"VpcId": {"Ref": "MyVPC"}, "InternetGatewayId": {"Ref": "MyInternetGateway"}}}, "MySubnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24", "MapPublicIpOnLaunch": true}}, "MyLoadBalancer": {"Type": "AWS::ElasticLoadBalancingV2::LoadBalancer", "Properties": {"Subnets": [{"Ref": "MySubnet"}], "SecurityGroups": [], "Type": "application"}}, "MyTargetGroup": {"Type": "AWS::ElasticLoadBalancingV2::TargetGroup", "Properties": {"Port": 80, "Protocol": "HTTP", "VpcId": {"Ref": "MyVPC"}, "HealthCheckEnabled": true, "HealthCheckPath": "/", "HealthCheckProtocol": "HTTP", "HealthCheckPort": "traffic-port"}}, "MyListener": {"Type": "AWS::ElasticLoadBalancingV2::Listener", "Properties": {"DefaultActions": [{"Type": "forward", "TargetGroupArn": {"Ref": "MyTargetGroup"}}], "LoadBalancerArn": {"Ref": "MyLoadBalancer"}, "Port": 80, "Protocol": "HTTP"}}, "InstanceSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "MyVPC"}, "GroupDescription": "Enable SSH access and HTTP access on the configured port", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 80, "ToPort": 80, "CidrIp": "0.0.0.0/0"}, {"IpProtocol": "tcp", "FromPort": 22, "ToPort": 22, "CidrIp": "0.0.0.0/0"}]}}, "EC2Instance1": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t2.micro", "SecurityGroups": [{"Ref": "InstanceSecurityGroup"}], "KeyName": "MyKeyPair", "ImageId": "ami-0abcdef1234567890", "SubnetId": {"Ref": "MySubnet"}}}, "EC2Instance2": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t2.micro", "SecurityGroups": [{"Ref": "InstanceSecurityGroup"}], "KeyName": "MyKeyPair", "ImageId": "ami-0abcdef1234567890", "SubnetId": {"Ref": "MySubnet"}}}}, "Outputs": {"LoadBalancerDNSName": {"Value": {"Fn::GetAtt": ["MyLoadBalancer", "DNSName"]}, "Description": "DNS name for the Load Balancer"}}}