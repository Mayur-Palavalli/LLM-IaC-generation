{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for an RDS DBInstance that is snapshotted on stack deletion.", "Resources": {"MyDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceClass": "db.t2.small", "AllocatedStorage": "20", "DBName": "MyDatabase", "Engine": "mysql", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "MyDatabasePasswordSecret"}, "DBSnapshotIdentifier": {"Fn::If": ["SnapshotOnDelete", {"Ref": "AWS::NoValue"}, {"Fn::Join": ["", [{"Ref": "AWS::StackName"}, "-snapshot"]]}]}}, "DeletionPolicy": "Snapshot", "UpdateReplacePolicy": "Snapshot"}}, "Parameters": {"SnapshotOnDelete": {"Description": "Indicates whether a snapshot should be created on delete.", "Type": "String", "Default": "true", "AllowedValues": ["true", "false"]}, "MyDatabasePasswordSecret": {"Description": "The Secrets Manager secret key containing the RDS instance master user password.", "Type": "String", "NoEcho": true}}, "Conditions": {"SnapshotOnDelete": {"Fn::Equals": [{"Ref": "SnapshotOnDelete"}, "true"]}}}