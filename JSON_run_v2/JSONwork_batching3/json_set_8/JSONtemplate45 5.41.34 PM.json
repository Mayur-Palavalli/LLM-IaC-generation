{"AWSTemplateFormatVersion": "2010-09-09", "Description": "CloudFormation template for Aurora RDS, DMS, and S3 bucket setup", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true}}, "MyS3Bucket": {"Type": "AWS::S3::Bucket"}, "MyDBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet Group for Aurora RDS Instance", "SubnetIds": [{"Ref": "SubnetA"}, {"Ref": "SubnetB"}]}}, "SubnetA": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24"}}, "SubnetB": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.2.0/24"}}, "MyAuroraInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBName": "MyDatabase", "DBInstanceClass": "db.r4.large", "Engine": "aurora-mysql", "MasterUsername": "admin", "DBSubnetGroupName": {"Ref": "MyDBSubnetGroup"}}}, "MyReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.c4.large", "PubliclyAccessible": true, "VpcSecurityGroupIds": ["sg-085912345678EXAMPLE"], "ReplicationSubnetGroupIdentifier": {"Ref": "MyReplicationSubnetGroup"}}}, "MyReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnet group for the DMS Replication Instance", "SubnetIds": [{"Ref": "SubnetA"}, {"Ref": "SubnetB"}]}}, "MySourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "source", "EngineName": "aurora", "DatabaseName": "MyDatabase", "Username": "admin", "ServerName": {"Fn::GetAtt": ["MyAuroraInstance", "Endpoint.Address"]}, "Port": 3306}}, "MyTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketFolder": "migrations", "CompressionType": "GZIP"}}}, "MyDmsTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationInstanceArn": {"Ref": "MyReplicationInstance"}, "SourceEndpointArn": {"Ref": "MySourceEndpoint"}, "TargetEndpointArn": {"Ref": "MyTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "TableMappings": "{\"TableMappings\":[{\"Type\": \"Include\",\"Path\": \"mySchema%\"}]}"}}, "MyDBMasterUserPassword": {"Type": "AWS::SSM::Parameter", "Properties": {"Type": "String", "Value": "YOUR_PASSWORD_HERE", "Description": "Master password for Aurora DBInstance"}}, "MyDBPassword": {"Type": "AWS::SSM::Parameter", "Properties": {"Type": "String", "Value": "YOUR_PASSWORD_HERE", "Description": "Database password for Aurora DMS Endpoint"}}}}