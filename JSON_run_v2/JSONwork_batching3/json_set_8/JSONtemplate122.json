{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"NeptuneDBCluster": {"Type": "AWS::Neptune::DBCluster", "Properties": {"DBClusterIdentifier": "my-neptune-cluster", "BackupRetentionPeriod": 7, "PreferredBackupWindow": "07:00-09:00", "PreferredMaintenanceWindow": "sun:23:00-mon:01:30", "StorageEncrypted": true}}, "NeptuneDBInstance": {"Type": "AWS::Neptune::DBInstance", "Properties": {"DBInstanceClass": "db.r5.large", "DBClusterIdentifier": {"Ref": "NeptuneDBCluster"}, "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}}}, "NeptuneDBClusterParameterGroup": {"Type": "AWS::Neptune::DBClusterParameterGroup", "Properties": {"Description": "Neptune DB Cluster Parameter Group", "Family": "neptune1", "Parameters": {"neptune_enable_audit_log": "1"}}}, "NeptuneDBInstanceParameterGroup": {"Type": "AWS::Neptune::DBParameterGroup", "Properties": {"Description": "Neptune DB Instance Parameter Group", "Family": "neptune1", "Parameters": {"neptune_query_timeout": "600000"}}}, "CICDPipeline": {"Type": "AWS::CodePipeline::Pipeline", "Properties": {"RoleArn": "arn:aws:iam::123456789012:role/AWSCodePipelineServiceRole", "Stages": [{"Name": "Source", "Actions": [{"Name": "Source", "ActionTypeId": {"Category": "Source", "Owner": "AWS", "Provider": "S3", "Version": "1"}, "Configuration": {"S3Bucket": "my-bucket", "S3ObjectKey": "source.zip"}, "OutputArtifacts": [{"Name": "SourceOutput"}], "RunOrder": 1}]}, {"Name": "Deploy", "Actions": [{"Name": "Deploy", "ActionTypeId": {"Category": "Deploy", "Owner": "AWS", "Provider": "CloudFormation", "Version": "1"}, "Configuration": {"ActionMode": "CREATE_UPDATE", "StackName": "NeptuneStack", "TemplatePath": "SourceOutput::template.yaml", "Capabilities": ["CAPABILITY_NAMED_IAM"]}, "InputArtifacts": [{"Name": "SourceOutput"}], "RunOrder": 1}]}], "ArtifactStore": {"Type": "S3", "Location": "my-codepipeline-artifacts"}}}, "NeptuneCloudWatchAlarm": {"Type": "AWS::CloudWatch::Alarm", "Properties": {"AlarmName": "NeptuneCPUUtilizationAlarm", "AlarmDescription": "Alarm if CPU exceeds 80%", "MetricName": "CPUUtilization", "Namespace": "AWS/Neptune", "Statistic": "Average", "Period": 300, "EvaluationPeriods": 1, "Threshold": 80, "ComparisonOperator": "GreaterThanThreshold", "Dimensions": [{"Name": "DBClusterIdentifier", "Value": {"Ref": "NeptuneDBCluster"}}], "AlarmActions": [{"Ref": "SNSTopic"}], "InsufficientDataActions": [], "OKActions": []}}, "SNSTopic": {"Type": "AWS::SNS::Topic", "Properties": {"TopicName": "NeptuneAlarmsTopic"}}, "SNSSubscription": {"Type": "AWS::SNS::Subscription", "Properties": {"Protocol": "email", "Endpoint": "myemail@example.com", "TopicArn": {"Ref": "SNSTopic"}}}}, "Outputs": {"NeptuneClusterEndpoint": {"Description": "The endpoint of the Neptune DB cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "Endpoint"]}}}}