{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create a Multi-AZ EFS with automount capabilities.", "Resources": {"FileSystem": {"Type": "AWS::EFS::FileSystem", "Properties": {"PerformanceMode": "generalPurpose", "Encrypted": true, "ThroughputMode": "bursting"}}, "MountTarget1": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "FileSystem"}, "SubnetId": "subnet-xxxxxx", "SecurityGroups": [{"Ref": "SecurityGroup1"}]}}, "MountTarget2": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "FileSystem"}, "SubnetId": "subnet-yyyyyy", "SecurityGroups": [{"Ref": "SecurityGroup1"}]}}, "SecurityGroup1": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Access EFS from EC2", "VpcId": "vpc-12345678"}}, "EC2Instance": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t3.micro", "ImageId": "ami-0abcdef1234567890", "KeyName": "MyKeyPair", "SubnetId": "subnet-xxxxxx", "SecurityGroupIds": [{"Ref": "SecurityGroup1"}], "UserData": {"Fn::Base64": {"Fn::Sub": ["#!/bin/bash\nyum install -y amazon-efs-utils\nmkdir /mnt/efs\necho '${FileSystemId}.efs.${AWS::Region}.amazonaws.com:/ /mnt/efs efs defaults,_netdev 0 0' >> /etc/fstab\nmount -a\n", {"FileSystemId": {"Ref": "FileSystem"}}]}}}}}, "Outputs": {"FileSystemId": {"Description": "The ID of the EFS file system created", "Value": {"Ref": "FileSystem"}, "Export": {"Name": {"Fn::Sub": "${AWS::StackName}-FileSystemId"}}}}}