{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"Vpc": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16"}}, "Subnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "Vpc"}, "CidrBlock": "10.0.1.0/24"}}, "InternetGateway": {"Type": "AWS::EC2::InternetGateway"}, "AttachGateway": {"Type": "AWS::EC2::VPCGatewayAttachment", "Properties": {"VpcId": {"Ref": "Vpc"}, "InternetGatewayId": {"Ref": "InternetGateway"}}}, "AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": {"Fn::Sub": "{{resolve:secretsmanager:DBMasterUsername}}"}, "MasterUserPassword": {"Fn::Sub": "{{resolve:secretsmanager:DBMasterUserPassword}}"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}]}}, "AuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceClass": "db.t3.medium", "Engine": "aurora-mysql", "DBClusterIdentifier": {"Ref": "AuroraDBCluster"}}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "DB Subnet Group", "SubnetIds": [{"Ref": "Subnet"}]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "Vpc"}, "GroupDescription": "Security Group for RDS"}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.r5.large", "AllocatedStorage": 100, "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "DMS Subnet Group", "SubnetIds": [{"Ref": "Subnet"}]}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "Vpc"}, "GroupDescription": "Security Group for DMS"}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora-mysql", "Username": {"Fn::Sub": "{{resolve:secretsmanager:DBMasterUsername}}"}, "Password": {"Fn::Sub": "{{resolve:secretsmanager:DBMasterUserPassword}}"}, "DatabaseName": "mydatabase", "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306}}, "S3Bucket": {"Type": "AWS::S3::Bucket"}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationInstanceArn": {"Ref": "DMSReplicationInstance"}, "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "TableMappings": "{}", "ReplicationTaskSettings": "{}"}}}}