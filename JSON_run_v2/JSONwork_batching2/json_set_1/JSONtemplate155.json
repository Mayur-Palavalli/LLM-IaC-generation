{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create an AD Connector to connect to an on-premises directory.", "Parameters": {"ConnectorDnsIpAddresses": {"Type": "List<String>", "Description": "DNS IP addresses for the on-premises directory."}, "VPCId": {"Type": "AWS::EC2::VPC::Id", "Description": "ID of the VPC where the AD Connector and other resources will be created."}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "List of subnet IDs where the AD Connector will reside."}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::Directory", "Properties": {"Name": "example.com", "Password": "password", "Size": "Small", "ConnectSettings": {"VpcId": {"Ref": "VPCId"}, "SubnetIds": {"Ref": "SubnetIds"}, "CustomerDnsIps": {"Ref": "ConnectorDnsIpAddresses"}, "CustomerUserName": "Admin"}, "Type": "ADConnector"}}, "DomainMembersSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VPCId"}, "GroupDescription": "Security group for domain members allowing all PrivateIP communications inbound", "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/8"}]}}, "DHCPOptionSet": {"Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainNameServers": {"Ref": "ConnectorDnsIpAddresses"}, "DomainName": "example.com"}}, "DHCPAttachment": {"Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Properties": {"VpcId": {"Ref": "VPCId"}, "DhcpOptionsId": {"Ref": "DHCPOptionSet"}}}, "SeamlessDomainJoinLinux": {"Type": "AWS::IAM::InstanceProfile", "Properties": {"Roles": ["AmazonSSMRoleForInstancesQuickSetup"]}}, "SeamlessDomainJoinWindows": {"Type": "AWS::IAM::InstanceProfile", "Properties": {"Roles": ["AmazonSSMRoleForWindowsQuickSetup"]}}}, "Outputs": {"ADConnectorId": {"Description": "ID of the created AD Connector", "Value": {"Ref": "ADConnector"}}, "DomainMembersSecurityGroupId": {"Description": "ID of the security group for domain members", "Value": {"Ref": "DomainMembersSecurityGroup"}}, "DHCPOptionSetId": {"Description": "ID of the created DHCPOptionSet", "Value": {"Ref": "DHCPOptionSet"}}, "SeamlessDomainJoinLinuxInstanceProfile": {"Description": "IAM Instance Profile for seamlessly domain joining Linux EC2 instances", "Value": {"Ref": "SeamlessDomainJoinLinux"}}, "SeamlessDomainJoinWindowsInstanceProfile": {"Description": "IAM Instance Profile for seamlessly domain joining Windows EC2 instances", "Value": {"Ref": "SeamlessDomainJoinWindows"}}}}