{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to provision an AWS Neptune Graph Database with CI/CD using CloudWatch and SNS.", "Resources": {"NeptuneDBCluster": {"Type": "AWS::Neptune::DBCluster", "Properties": {"DBClusterIdentifier": "neptune-cluster", "BackupRetentionPeriod": 7, "PreferredBackupWindow": "07:00-09:00", "PreferredMaintenanceWindow": "sun:23:45-mon:00:15", "Engine": "neptune"}}, "NeptuneDBInstance": {"Type": "AWS::Neptune::DBInstance", "Properties": {"DBInstanceClass": "db.r5.large", "DBClusterIdentifier": {"Ref": "NeptuneDBCluster"}, "DBInstanceIdentifier": "neptune-instance"}}, "NeptuneDBClusterParameterGroup": {"Type": "AWS::Neptune::DBClusterParameterGroup", "Properties": {"Description": "Cluster parameter group for Neptune", "Family": "neptune1", "Parameters": {"neptune_enable_audit_log": "1"}}}, "NeptuneRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "rds.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "NeptunePolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["cloudwatch:PutMetricData", "logs:CreateLogGroup", "logs:CreateLogStream", "logs:PutLogEvents", "sns:Publish"], "Resource": "*"}]}}]}}, "CloudWatchLogGroup": {"Type": "AWS::Logs::LogGroup", "Properties": {"LogGroupName": "/aws/neptune/logs"}}, "SNSTopic": {"Type": "AWS::SNS::Topic", "Properties": {"DisplayName": "Neptune Notifications", "Subscription": [{"Protocol": "email", "Endpoint": "your-email@example.com"}]}}, "CloudWatchAlarm": {"Type": "AWS::CloudWatch::Alarm", "Properties": {"AlarmName": "NeptuneCPUUtilization", "ComparisonOperator": "GreaterThanThreshold", "EvaluationPeriods": 1, "MetricName": "CPUUtilization", "Namespace": "AWS/Neptune", "Period": 300, "Statistic": "Average", "Threshold": 70, "AlarmActions": [{"Ref": "SNSTopic"}], "Dimensions": [{"Name": "DBClusterIdentifier", "Value": {"Ref": "NeptuneDBCluster"}}]}}}, "Outputs": {"NeptuneClusterEndpoint": {"Description": "Endpoint of the Neptune DB Cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "Endpoint"]}}, "NeptuneReaderEndpoint": {"Description": "Reader endpoint of the Neptune DB Cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "ReadEndpoint"]}}}}