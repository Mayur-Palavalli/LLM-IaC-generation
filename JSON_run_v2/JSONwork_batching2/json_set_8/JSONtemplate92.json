{"AWSTemplateFormatVersion": "2010-09-09", "Description": "CloudFormation template to deploy two EC2 instances behind a load balancer with a simple health check.", "Parameters": {"Subnet1": {"Type": "String", "Description": "The first subnet ID for the load balancer"}, "Subnet2": {"Type": "String", "Description": "The second subnet ID for the load balancer"}, "VPC": {"Type": "String", "Description": "VPC ID"}}, "Resources": {"WebServerSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable HTTP access", "VpcId": {"Ref": "VPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 80, "ToPort": 80, "CidrIp": "0.0.0.0/0"}, {"IpProtocol": "tcp", "FromPort": 8888, "ToPort": 8888, "CidrIp": "0.0.0.0/0"}]}}, "Instance1": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t2.micro", "SecurityGroups": [{"Ref": "WebServerSecurityGroup"}], "ImageId": "ami-0c55b159cbfafe1f0"}}, "Instance2": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t2.micro", "SecurityGroups": [{"Ref": "WebServerSecurityGroup"}], "ImageId": "ami-0c55b159cbfafe1f0"}}, "LoadBalancer": {"Type": "AWS::ElasticLoadBalancingV2::LoadBalancer", "Properties": {"Type": "application", "Subnets": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}], "SecurityGroups": [{"Fn::GetAtt": ["WebServerSecurityGroup", "GroupId"]}]}}, "LoadBalancerListener": {"Type": "AWS::ElasticLoadBalancingV2::Listener", "Properties": {"DefaultActions": [{"Type": "forward", "TargetGroupArn": {"Ref": "TargetGroup"}}], "LoadBalancerArn": {"Ref": "LoadBalancer"}, "Port": 80, "Protocol": "HTTP"}}, "TargetGroup": {"Type": "AWS::ElasticLoadBalancingV2::TargetGroup", "Properties": {"HealthCheckIntervalSeconds": 30, "HealthCheckPath": "/", "HealthCheckProtocol": "HTTP", "HealthCheckTimeoutSeconds": 5, "HealthyThresholdCount": 3, "UnhealthyThresholdCount": 5, "Port": 80, "Protocol": "HTTP", "VpcId": {"Ref": "VPC"}, "Targets": [{"Id": {"Ref": "Instance1"}}, {"Id": {"Ref": "Instance2"}}]}}}, "Outputs": {"LoadBalancerURL": {"Value": {"Fn::Join": ["", ["http://", {"Fn::GetAtt": ["LoadBalancer", "DNSName"]}]]}, "Description": "URL of the load balancer"}}}