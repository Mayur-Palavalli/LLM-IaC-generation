{"AWSTemplateFormatVersion": "2010-09-09", "Description": "CloudFormation template to create an AD Connector, domain join resources, domain members security group, and DHCP options set", "Parameters": {"DirectoryName": {"Type": "String", "Description": "Fully qualified domain name (FQDN) of the on-premises directory."}, "CustomerDnsIps": {"Type": "CommaDelimitedList", "Description": "A list of IP addresses of DNS servers for the on-premises directory."}, "SubnetIds": {"Type": "CommaDelimitedList", "Description": "Comma-delimited list of VPC subnet IDs for the AD Connector."}, "VPCId": {"Type": "String", "Description": "ID of the VPC where the resources will be created."}, "CreateSeamlessDomainJoin": {"Type": "String", "Description": "Whether to create seamless domain join resources for Windows & Linux EC2 instances.", "AllowedValues": ["yes", "no"], "Default": "no"}, "CreateDomainMembersSG": {"Type": "String", "Description": "Whether to create a security group for domain member communication.", "AllowedValues": ["yes", "no"], "Default": "no"}, "CreateDHCPOptionSet": {"Type": "String", "Description": "Whether to create a DHCP option set pointing to domain DNS servers.", "AllowedValues": ["yes", "no"], "Default": "no"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "DirectoryName"}, "VpcSettings": {"SubnetIds": {"Ref": "SubnetIds"}, "VpcId": {"Ref": "VPCId"}}}}, "DHCPOptionSet": {"Condition": "CreateDHCPOptionSetCondition", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainName": {"Ref": "DirectoryName"}, "DomainNameServers": {"Ref": "CustomerDnsIps"}}}, "DomainMembersSG": {"Condition": "CreateDomainMembersSGCondition", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for domain member communication", "VpcId": {"Ref": "VPCId"}, "SecurityGroupIngress": [{"IpProtocol": "-1", "SourceSecurityGroupId": {"Ref": "AWS::StackName"}}], "Tags": [{"Key": "Name", "Value": "DomainMembersSG"}]}}}, "Conditions": {"CreateDomainMembersSGCondition": {"Fn::Equals": [{"Ref": "CreateDomainMembersSG"}, "yes"]}, "CreateDHCPOptionSetCondition": {"Fn::Equals": [{"Ref": "CreateDHCPOptionSet"}, "yes"]}}, "Outputs": {"ADConnectorID": {"Value": {"Ref": "ADConnector"}, "Description": "ID of the Active Directory Connector"}, "DomainMembersSecurityGroupID": {"Condition": "CreateDomainMembersSGCondition", "Value": {"Ref": "DomainMembersSG"}, "Description": "ID of the domain members security group"}, "DHCPOptionSetID": {"Condition": "CreateDHCPOptionSetCondition", "Value": {"Ref": "DHCPOptionSet"}, "Description": "ID of the DHCP Option Set"}}}