{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"LinuxEC2Instance": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t3.medium", "IamInstanceProfile": "YourSSMInstanceProfile", "Tags": [{"Key": "InstanceType", "Value": "Linux"}]}}, "WindowsEC2Instance1": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t3.medium", "IamInstanceProfile": "YourSSMInstanceProfile", "Tags": [{"Key": "InstanceType", "Value": "Windows"}]}}, "WindowsEC2Instance2": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t3.medium", "IamInstanceProfile": "YourSSMInstanceProfile", "Tags": [{"Key": "InstanceType", "Value": "Windows"}]}}, "WindowsEC2Instance3": {"Type": "AWS::EC2::Instance", "Properties": {"ImageId": "ami-0abcdef1234567890", "InstanceType": "t3.medium", "IamInstanceProfile": "YourSSMInstanceProfile", "Tags": [{"Key": "InstanceType", "Value": "Windows"}]}}, "InlineSSMAssociation": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "InstanceId": {"Ref": "WindowsEC2Instance1"}, "Parameters": {"directoryId": ["d-xxxxxxxxxx"]}}}, "TargetedSSMASociations": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "Targets": [{"Key": "InstanceIds", "Values": [{"Ref": "LinuxEC2Instance"}, {"Ref": "WindowsEC2Instance2"}, {"Ref": "WindowsEC2Instance3"}]}], "Parameters": {"directoryId": ["d-xxxxxxxxxx"]}}}, "TagTargetedSSMAssociation": {"Type": "AWS::SSM::Association", "Properties": {"Name": "AWS-JoinDirectoryServiceDomain", "Targets": [{"Key": "tag:InstanceType", "Values": ["Windows"]}], "Parameters": {"directoryId": ["d-xxxxxxxxxx"]}}}}}