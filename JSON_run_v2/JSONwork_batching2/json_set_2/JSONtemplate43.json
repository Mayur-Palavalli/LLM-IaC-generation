{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true}}, "MySubnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "MyVPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}}}, "AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "DBClusterIdentifier": "aurora-cluster", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "DBMasterUserPassword"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "DBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceIdentifier": "aurora-instance", "Engine": "aurora-mysql", "DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "DBInstanceClass": "db.r5.large", "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora DB cluster", "SubnetIds": [{"Ref": "MySubnet"}]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "MyVPC"}, "GroupDescription": "Security Group for Aurora DB cluster"}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupIdentifier": "dms-subnet-group", "ReplicationSubnetGroupDescription": "Subnet group for DMS instance", "SubnetIds": [{"Ref": "MySubnet"}]}}, "DMSInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t2.medium", "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}, "ReplicationInstanceArn": {"Ref": "DMSReplicationInstanceArn"}}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Ref": "DMSUserPassword"}, "ServerName": {"Fn::GetAtt": ["DBInstance", "Endpoint.Address"]}, "Port": {"Fn::GetAtt": ["DBInstance", "Endpoint.Port"]}}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"ServiceAccessRoleArn": "arn:aws:iam::YOUR_ACCOUNT_ID:role/YOUR_DMS_ROLE"}, "BucketName": {"Ref": "MyDMSBucketName"}}}, "MyS3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": {"Ref": "MyDMSBucketName"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"ReplicationTaskIdentifier": "dms-task", "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "MigrationType": "full-load-and-cdc", "TableMappings": "{\"rules\": [{\"rule-type\": \"selection\",\"rule-id\": \"1\",\"rule-name\": \"1\",\"object-locator\": {\"schema-name\": \"%\",\"table-name\": \"%\"},\"rule-action\": \"include\"}]}", "ReplicationTaskSettings": "{}"}}}, "Parameters": {"DBMasterUserPassword": {"Type": "String", "NoEcho": true, "Description": "The password for the master database user"}, "DMSUserPassword": {"Type": "String", "NoEcho": true, "Description": "The password for the DMS user"}, "DMSReplicationInstanceArn": {"Type": "String", "Description": "The ARN of the DMS replication instance"}, "MyDMSBucketName": {"Type": "String", "Description": "The name of the S3 bucket used by DMS"}}}