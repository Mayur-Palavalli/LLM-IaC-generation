{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for an AD Connector to connect to an on-premises directory with optional resources.", "Parameters": {"VpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC ID where the resources will be created"}, "SubnetIds": {"Type": "List<AWS::EC2::Subnet::Id>", "Description": "Subnets for the AD Connector"}, "DomainDnsIpAddresses": {"Type": "List<String>", "Description": "IP addresses of the DNS servers for your on-premises directory"}, "ConnectorName": {"Type": "String", "Description": "Name of the AD Connector"}, "ServiceAccountUsername": {"Type": "String", "Description": "Username for the service account"}, "ServiceAccountPassword": {"Type": "String", "NoEcho": true, "Description": "Password for the service account"}}, "Resources": {"ADConnector": {"Type": "AWS::DirectoryService::MicrosoftAD", "Properties": {"Name": {"Ref": "ConnectorName"}, "Password": {"Ref": "ServiceAccountPassword"}, "VpcSettings": {"SubnetIds": {"Ref": "SubnetIds"}, "VpcId": {"Ref": "VpcId"}}}}, "SeamlessDomainJoinGroup": {"Condition": "CreateSeamlessDomainJoin", "Type": "AWS::SSM::Parameter", "Properties": {"Name": {"Fn::Sub": "/aws/service/directory/${ConnectorName}/domain"}, "Type": "String", "Value": {"Ref": "ConnectorName"}}}, "DomainMembersSG": {"Condition": "CreateDomainMembersSG", "Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VpcId"}, "GroupDescription": "Security group for domain members", "SecurityGroupIngress": [{"IpProtocol": "-1", "CidrIp": "10.0.0.0/8"}]}}, "DhcpOptionSet": {"Condition": "CreateDhcpOptionSet", "Type": "AWS::EC2::DHCPOptions", "Properties": {"DomainNameServers": {"Fn::Join": [",", {"Ref": "DomainDnsIpAddresses"}]}}}}, "Conditions": {"CreateSeamlessDomainJoin": {"Fn::Not": [{"Fn::Equals": ["", {"Ref": "ConnectorName"}]}]}, "CreateDomainMembersSG": {"Fn::Not": [{"Fn::Equals": ["", {"Ref": "VpcId"}]}]}, "CreateDhcpOptionSet": {"Fn::Not": [{"Fn::Equals": ["", {"Ref": "DomainDnsIpAddresses"}]}]}}}