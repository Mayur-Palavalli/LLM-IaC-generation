{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": {"Fn::Sub": "{{resolve:ssm-secure:DBMasterPassword:::}}"}, "DBClusterIdentifier": "aurora-cluster", "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}}}, "AuroraInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "DBInstanceClass": "db.r5.large", "Engine": "aurora-mysql"}}, "DMSInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t2.medium", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}}}, "S3Bucket": {"Type": "AWS::S3::Bucket"}, "SourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Ref": "DBMasterPassword"}, "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "TargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationTaskIdentifier": "my-dms-task", "SourceEndpointArn": {"Fn::GetAtt": ["SourceEndpoint", "Id"]}, "TargetEndpointArn": {"Fn::GetAtt": ["TargetEndpoint", "Id"]}, "ReplicationInstanceArn": {"Fn::GetAtt": ["DMSInstance", "Id"]}, "TableMappings": "{\"rules\": [{\"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": {\"schema-name\": \"%\", \"table-name\": \"%\"}, \"rule-action\": \"include\"}]}"}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for Aurora RDS instance", "VpcId": {"Ref": "VPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for DMS instance", "VpcId": {"Ref": "VPC"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "SourceSecurityGroupId": {"Ref": "DBSecurityGroup"}}]}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora RDS instance", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupIdentifier": "dms-subnet-group", "ReplicationSubnetGroupDescription": "Subnet group for DMS instance", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}}, "Parameters": {"VPC": {"Type": "AWS::EC2::VPC::Id", "Description": "VPC Id"}, "Subnet1": {"Type": "AWS::EC2::Subnet::Id", "Description": "Subnet 1 Id"}, "Subnet2": {"Type": "AWS::EC2::Subnet::Id", "Description": "Subnet 2 Id"}}}