{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to provision AWS Neptune Graph Database with CI/CD integration, CloudWatch and SNS.", "Resources": {"NeptuneClusterParameterGroup": {"Type": "AWS::Neptune::DBClusterParameterGroup", "Properties": {"Description": "Neptune cluster parameter group", "Family": "neptune1", "Parameters": {"neptune_enable_audit_log": "1"}}}, "NeptuneDBCluster": {"Type": "AWS::Neptune::DBCluster", "Properties": {"DBSubnetGroupName": {"Ref": "NeptuneSubnetGroup"}, "DBClusterParameterGroupName": {"Ref": "NeptuneClusterParameterGroup"}, "VpcSecurityGroupIds": [{"Ref": "NeptuneSecurityGroup"}], "BackupRetentionPeriod": 7, "PreferredBackupWindow": "07:00-09:00", "PreferredMaintenanceWindow": "sun:07:00-sun:09:00", "EngineVersion": "1.0.4.2", "StorageEncrypted": true}}, "NeptuneDBInstance": {"Type": "AWS::Neptune::DBInstance", "Properties": {"DBInstanceClass": "db.r5.large", "DBClusterIdentifier": {"Ref": "NeptuneDBCluster"}, "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}}}, "NeptuneSubnetGroup": {"Type": "AWS::Neptune::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Neptune cluster", "SubnetIds": ["subnet-abc12345", "subnet-def67890"]}}, "NeptuneSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security group for Neptune cluster", "VpcId": "vpc-11223344", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 8182, "ToPort": 8182, "CidrIp": "0.0.0.0/0"}]}}, "CodePipelineSNS": {"Type": "AWS::SNS::Topic", "Properties": {"TopicName": "NeptunePipelineNotifications"}}, "CloudWatchAlarm": {"Type": "AWS::CloudWatch::Alarm", "Properties": {"AlarmDescription": "Alarm if CPU exceeds 80%", "MetricName": "CPUUtilization", "Namespace": "AWS/Neptune", "Statistic": "Average", "Period": 300, "EvaluationPeriods": 2, "Threshold": 80, "ComparisonOperator": "GreaterThanThreshold", "Dimensions": [{"Name": "DBInstanceIdentifier", "Value": {"Ref": "NeptuneDBInstance"}}], "AlarmActions": [{"Ref": "CodePipelineSNS"}]}}}, "Outputs": {"NeptuneDBClusterEndpoint": {"Description": "Endpoint for the Neptune DB Cluster", "Value": {"Fn::GetAtt": ["NeptuneDBCluster", "Endpoint"]}}}}