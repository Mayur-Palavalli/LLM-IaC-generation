{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true, "Tags": [{"Key": "Name", "Value": "MyVPC"}]}}, "Subnet": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}, "Tags": [{"Key": "Name", "Value": "MySubnet"}]}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora RDS", "SubnetIds": [{"Ref": "Subnet"}]}}, "AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": {"Fn::Join": ["", ["{{resolve:secretsmanager:", {"Ref": "DBMasterPassword"}, "}}"]]}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VPC"}, "GroupDescription": "Security group for Aurora RDS", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "DMS Subnet Group", "SubnetIds": [{"Ref": "Subnet"}]}}, "DMSInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.t3.micro", "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}]}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VPC"}, "GroupDescription": "Security group for DMS", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "SourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "admin", "Password": {"Fn::Join": ["", ["{{resolve:secretsmanager:", {"Ref": "DBSourcePassword"}, "}}"]]}, "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "S3Bucket": {"Type": "AWS::S3::Bucket"}, "TargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "SourceEndpointArn": {"Ref": "SourceEndpoint"}, "TargetEndpointArn": {"Ref": "TargetEndpoint"}, "ReplicationInstanceArn": {"Ref": "DMSInstance"}, "TableMappings": "{}", "ReplicationTaskSettings": "{}"}}}, "Outputs": {"S3BucketName": {"Description": "Name of the S3 bucket for DMS target", "Value": {"Ref": "S3Bucket"}}, "DBClusterEndpoint": {"Description": "Aurora DB Cluster Endpoint", "Value": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}}}, "Parameters": {"DBMasterPassword": {"Type": "String", "NoEcho": true, "Description": "Password for the DB master user"}, "DBSourcePassword": {"Type": "String", "NoEcho": true, "Description": "Password for the source endpoint"}}}