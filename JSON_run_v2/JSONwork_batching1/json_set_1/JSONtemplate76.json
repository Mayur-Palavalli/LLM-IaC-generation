{"AWSTemplateFormatVersion": "2010-09-09", "Description": "Amazon EKS Cluster on EC2 Sample Template", "Resources": {"EKSClusterRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "eks.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"]}}, "EKSEC2Role": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy", "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly", "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy"]}}, "EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": "my-eks-cluster", "ResourcesVpcConfig": {"SubnetIds": ["subnet-xxxxxxx", "subnet-yyyyyyy"], "SecurityGroupIds": ["sg-zzzzzzzz"]}, "RoleArn": {"Fn::GetAtt": ["EKSClusterRole", "Arn"]}, "Version": "1.21"}}, "EKSNodeGroup": {"Type": "AWS::EKS::Nodegroup", "Properties": {"ClusterName": {"Ref": "EKSCluster"}, "NodeGroupName": "my-eks-nodegroup", "Subnets": ["subnet-xxxxxxx", "subnet-yyyyyyy"], "NodeRole": {"Fn::GetAtt": ["EKSEC2Role", "Arn"]}, "ScalingConfig": {"MinSize": 1, "MaxSize": 3, "DesiredSize": 2}, "AmiType": "AL2_x86_64", "InstanceTypes": ["t3.medium"], "DiskSize": 20}}}, "Outputs": {"ClusterName": {"Description": "Name of the EKS Cluster", "Value": {"Ref": "EKSCluster"}}, "NodeGroupName": {"Description": "Name of the EKS Node Group", "Value": {"Ref": "EKSNodeGroup"}}}}