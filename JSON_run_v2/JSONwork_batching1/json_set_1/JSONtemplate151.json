{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template to create AD Connector and related resources", "Parameters": {"InstanceVpcId": {"Type": "AWS::EC2::VPC::Id", "Description": "The VPC ID for the AD Connector"}, "DomainDnsIpAddresses": {"Type": "List<AWS::EC2::IPAddress>", "Description": "The IP addresses of the DNS servers for the on-premises directory"}, "ServiceAccountUsername": {"Type": "String", "Description": "Service account username for AD Connector"}, "ServiceAccountPassword": {"Type": "String", "Description": "Service account password for AD Connector", "NoEcho": true}, "DomainDnsName": {"Type": "String", "Description": "DNS name of the on-premises directory"}}, "Resources": {"AdConnector": {"Type": "AWS::DirectoryService::Connector", "Properties": {"VpcSettings": {"VpcId": {"Ref": "InstanceVpcId"}, "SubnetIds": [{"Fn::Select": ["0", {"Fn::GetAZs": {"Ref": "AWS::Region"}}]}, {"Fn::Select": ["1", {"Fn::GetAZs": {"Ref": "AWS::Region"}}]}]}, "DirectoryName": {"Ref": "DomainDnsName"}, "Password": {"Ref": "ServiceAccountPassword"}, "Size": "Small", "ConnectSettings": {"CustomerDnsIps": {"Ref": "DomainDnsIpAddresses"}, "CustomerUserName": {"Ref": "ServiceAccountUsername"}}}}, "DomainMembersSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Condition": "CreateSecurityGroup", "Properties": {"VpcId": {"Ref": "InstanceVpcId"}, "GroupDescription": "Security group for domain member instances", "SecurityGroupIngress": [{"IpProtocol": "-1", "FromPort": 0, "ToPort": 65535, "SourceSecurityGroupId": {"Ref": "DomainMembersSecurityGroup"}}], "SecurityGroupEgress": [{"IpProtocol": "-1", "FromPort": 0, "ToPort": 65535, "CidrIp": "0.0.0.0/0"}]}}, "DHCPOptionSet": {"Type": "AWS::EC2::DHCPOptions", "Condition": "CreateDhcpOptions", "Properties": {"DomainName": {"Ref": "DomainDnsName"}, "DomainNameServers": {"Ref": "DomainDnsIpAddresses"}}}, "VPCDHCPOptionsAssociation": {"Type": "AWS::EC2::VPCDHCPOptionsAssociation", "Condition": "CreateDhcpOptions", "Properties": {"VpcId": {"Ref": "InstanceVpcId"}, "DhcpOptionsId": {"Ref": "DHCPOptionSet"}}}}, "Conditions": {"CreateSecurityGroup": {"Fn::Equals": ["true", "true"]}, "CreateDhcpOptions": {"Fn::Equals": ["true", "true"]}}, "Outputs": {"AdConnector": {"Description": "AD Connector ID", "Value": {"Ref": "AdConnector"}}, "DomainMembersSecurityGroup": {"Description": "Security Group for domain member instances", "Value": {"Ref": "DomainMembersSecurityGroup"}}, "DHCPOptionSet": {"Description": "DHCP Option Set", "Value": {"Ref": "DHCPOptionSet"}}}}