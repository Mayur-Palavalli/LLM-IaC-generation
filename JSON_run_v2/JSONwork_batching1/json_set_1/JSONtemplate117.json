{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"MyChannel": {"Type": "AWS::IoTAnalytics::Channel", "Properties": {"ChannelName": "MyChannel", "ChannelStorage": {"CustomerManagedS3": {"Bucket": "my-channel-bucket", "RoleArn": "arn:aws:iam::123456789012:role/MyChannelRole"}}}}, "MyDatastore": {"Type": "AWS::IoTAnalytics::Datastore", "Properties": {"DatastoreName": "MyDatastore", "DatastoreStorage": {"CustomerManagedS3": {"Bucket": "my-datastore-bucket", "RoleArn": "arn:aws:iam::123456789012:role/MyDatastoreRole"}}}}, "MyPipeline": {"Type": "AWS::IoTAnalytics::Pipeline", "Properties": {"PipelineName": "MyPipeline", "PipelineActivities": [{"Channel": {"Name": "ChannelActivity", "ChannelName": {"Ref": "MyChannel"}, "Next": "DatastoreActivity"}}, {"Lambda": {"Name": "LambdaActivity", "LambdaName": "MyLambdaFunction", "BatchSize": 100, "Next": "DatastoreActivity", "RoleArn": "arn:aws:iam::123456789012:role/MyLambdaExecutionRole"}}, {"Datastore": {"Name": "DatastoreActivity", "DatastoreName": {"Ref": "MyDatastore"}}}]}}, "MyDataset": {"Type": "AWS::IoTAnalytics::Dataset", "Properties": {"DatasetName": "MyDataset", "Actions": [{"ActionName": "QueryAction", "QueryAction": {"SqlQuery": "SELECT * FROM my_datastore", "Filters": []}}], "Triggers": [{"Schedule": {"ScheduleExpression": "rate(1 hour)"}}], "ContentDeliveryRules": [{"Destination": {"S3DestinationConfiguration": {"Bucket": "my-dataset-bucket", "Key": "my-dataset-output", "RoleArn": "arn:aws:iam::123456789012:role/MyDatasetRole"}}}]}}}}