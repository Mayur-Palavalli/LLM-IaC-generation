{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"VPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16"}}, "Subnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.1.0/24"}}, "Subnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "VPC"}, "CidrBlock": "10.0.2.0/24"}}, "DBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "adminuser", "MasterUserPassword": {"Fn::Sub": "{{resolve:ssm-secure:DBMasterUserPassword}}"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}]}}, "DBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "DBCluster"}, "DBInstanceClass": "db.t3.medium"}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora RDS instance", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VPC"}, "GroupDescription": "Security Group for Aurora RDS instance"}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "VPC"}, "GroupDescription": "Security Group for DMS"}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.c5.large", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnet group for DMS instance", "SubnetIds": [{"Ref": "Subnet1"}, {"Ref": "Subnet2"}]}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "source", "EngineName": "aurora-mysql", "EndpointIdentifier": "aurora-source-endpoint", "Username": "adminuser", "Password": {"Fn::Sub": "{{resolve:ssm-secure:DMSSourceEndpointPassword}}"}, "ServerName": {"Fn::GetAtt": ["DBInstance", "Endpoint.Address"]}, "Port": "3306", "DatabaseName": "mydatabase"}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointType": "target", "EngineName": "s3", "EndpointIdentifier": "s3-target-endpoint", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}, "ServiceAccessRoleArn": "arn:aws:iam::123456789012:role/DMSAccessForS3"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "ReplicationInstanceArn": {"Ref": "DMSReplicationInstance"}, "TableMappings": "{ \"rules\": [{ \"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": { \"schema-name\": \"dbo\", \"table-name\": \"%\" }, \"rule-action\": \"include\" }] }"}}}, "Parameters": {"DBMasterUserPassword": {"Type": "String", "NoEcho": true, "MinLength": 8, "MaxLength": 41, "Description": "The master password for the database."}, "DMSSourceEndpointPassword": {"Type": "String", "NoEcho": true, "MinLength": 8, "MaxLength": 41, "Description": "The password for the DMS source endpoint."}}}