{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"EKSControlPlaneRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "eks.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"]}}, "EKSEC2InstanceRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "ec2.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy", "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy", "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"]}}, "EKSCluster": {"Type": "AWS::EKS::Cluster", "Properties": {"Name": "my-eks-cluster", "ResourcesVpcConfig": {"SubnetIds": [{"Ref": "EKSPublicSubnet1"}, {"Ref": "EKSPublicSubnet2"}], "SecurityGroupIds": [{"Ref": "EKSSecurityGroup"}]}, "RoleArn": {"Fn::GetAtt": ["EKSControlPlaneRole", "Arn"]}}}, "EKSPublicSubnet1": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "EKSVPC"}, "CidrBlock": "10.0.1.0/24", "AvailabilityZone": {"Fn::Select": [0, {"Fn::GetAZs": ""}]}, "MapPublicIpOnLaunch": true}}, "EKSPublicSubnet2": {"Type": "AWS::EC2::Subnet", "Properties": {"VpcId": {"Ref": "EKSVPC"}, "CidrBlock": "10.0.2.0/24", "AvailabilityZone": {"Fn::Select": [1, {"Fn::GetAZs": ""}]}, "MapPublicIpOnLaunch": true}}, "EKSVPC": {"Type": "AWS::EC2::VPC", "Properties": {"CidrBlock": "10.0.0.0/16", "EnableDnsSupport": true, "EnableDnsHostnames": true, "Tags": [{"Key": "Name", "Value": "eks-vpc"}]}}, "EKSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"VpcId": {"Ref": "EKSVPC"}, "GroupDescription": "EKS Cluster security group"}}, "EKSNodeGroup": {"Type": "AWS::EKS::Nodegroup", "Properties": {"ClusterName": {"Ref": "EKSCluster"}, "NodeRole": {"Fn::GetAtt": ["EKSEC2InstanceRole", "Arn"]}, "Subnets": [{"Ref": "EKSPublicSubnet1"}, {"Ref": "EKSPublicSubnet2"}], "ScalingConfig": {"DesiredSize": 2, "MaxSize": 3, "MinSize": 1}, "InstanceTypes": ["t3.medium"], "AmiType": "AL2_x86_64"}}}, "Outputs": {"EKSClusterName": {"Description": "Name of the EKS Cluster", "Value": {"Ref": "EKSCluster"}}}}