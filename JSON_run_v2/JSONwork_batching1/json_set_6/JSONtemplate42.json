{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": {"Ref": "DBMasterUserPassword"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}]}}, "AuroraInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraCluster"}, "DBInstanceClass": "db.r5.large"}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "DB subnet group", "SubnetIds": ["subnet-12345678", "subnet-23456789"]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for Aurora RDS", "VpcId": "vpc-12345678"}}, "DMSInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.r5.large", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Security Group for DMS", "VpcId": "vpc-12345678"}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupIdentifier": "dms-subnet-group", "SubnetIds": ["subnet-12345678", "subnet-23456789"], "ReplicationSubnetGroupDescription": "DMS subnet group"}}, "SourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source", "EndpointType": "source", "EngineName": "aurora-mysql", "Username": "admin", "Password": {"Ref": "DBSourceEndpointPassword"}, "ServerName": {"Fn::GetAtt": ["AuroraCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "S3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "my-dms-target"}}, "TargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "S3Bucket"}, "ServiceAccessRoleArn": "arn:aws:iam::123456789012:role/myDmsRole"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "SourceEndpointArn": {"Fn::GetAtt": ["SourceEndpoint", "EndpointArn"]}, "TargetEndpointArn": {"Fn::GetAtt": ["TargetEndpoint", "EndpointArn"]}, "ReplicationInstanceArn": {"Fn::GetAtt": ["DMSInstance", "ReplicationInstanceArn"]}, "TableMappings": "{\"rules\": [{\"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": {\"schema-name\": \"%\", \"table-name\": \"%\"}, \"rule-action\": \"include\"}]}", "ReplicationTaskSettings": "{}"}}}, "Parameters": {"DBMasterUserPassword": {"Type": "AWS::SecretsManager::Secret", "Description": "Master User Password for the Database"}, "DBSourceEndpointPassword": {"Type": "AWS::SecretsManager::Secret", "Description": "Source Endpoint Password for the Database"}}}