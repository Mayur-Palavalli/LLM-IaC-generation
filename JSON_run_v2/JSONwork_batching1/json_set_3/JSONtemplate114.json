{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation template for setting up Greengrass resources and group.", "Resources": {"GreengrassGroup": {"Type": "AWS::Greengrass::Group", "Properties": {"Name": "MyGreengrassGroup", "InitialVersion": {"CoreDefinitionVersionArn": {"Ref": "CoreDefinitionVersion"}, "DeviceDefinitionVersionArn": {"Ref": "DeviceDefinitionVersion"}, "FunctionDefinitionVersionArn": {"Ref": "FunctionDefinitionVersion"}, "ResourceDefinitionVersionArn": {"Ref": "ResourceDefinitionVersion"}}}}, "CoreDefinition": {"Type": "AWS::Greengrass::CoreDefinition", "Properties": {"Name": "MyGreengrassCoreDefinition", "InitialVersion": {"Cores": [{"Id": "MyCoreId", "ThingArn": {"Ref": "GreengrassCoreThing"}, "CertificateArn": {"Ref": "GreengrassCoreCert"}, "SyncShadow": true}]}}}, "DeviceDefinition": {"Type": "AWS::Greengrass::DeviceDefinition", "Properties": {"Name": "MyGreengrassDeviceDefinition", "InitialVersion": {"Devices": [{"Id": "MyDeviceId", "ThingArn": {"Ref": "GreengrassDeviceThing"}, "CertificateArn": {"Ref": "GreengrassDeviceCert"}, "SyncShadow": true}]}}}, "FunctionDefinition": {"Type": "AWS::Greengrass::FunctionDefinition", "Properties": {"Name": "MyGreengrassFunctionDefinition", "InitialVersion": {"Functions": [{"Id": "MyFunctionId", "FunctionArn": {"Ref": "GreengrassLambdaFunctionArn"}, "FunctionConfiguration": {"EncodingType": "json", "Environment": {"ResourceAccessPolicies": [], "Variables": {}}, "Executable": "MyLambdaExecutable", "MemorySize": 32768, "Pinned": true, "Timeout": 3}}]}}}, "ResourceDefinition": {"Type": "AWS::Greengrass::ResourceDefinition", "Properties": {"Name": "MyGreengrassResourceDefinition", "InitialVersion": {"Resources": [{"Id": "MyResourceId", "Name": "MyResourceName", "ResourceDataContainer": {"LocalDeviceResourceData": {"SourcePath": "/source/path/to/device", "GroupOwnerSetting": {"AutoAddGroupOwner": false, "GroupOwner": "group-owner"}}}}]}}}, "GreengrassCoreThing": {"Type": "AWS::IoT::Thing", "Properties": {"ThingName": "MyGreengrassCoreThing"}}, "GreengrassDeviceThing": {"Type": "AWS::IoT::Thing", "Properties": {"ThingName": "MyGreengrassDeviceThing"}}, "GreengrassCoreCert": {"Type": "AWS::IoT::Certificate", "Properties": {"Status": "ACTIVE"}}, "GreengrassDeviceCert": {"Type": "AWS::IoT::Certificate", "Properties": {"Status": "ACTIVE"}}, "CoreDefinitionVersion": {"Type": "AWS::Greengrass::CoreDefinitionVersion", "Properties": {"CoreDefinitionId": {"Ref": "CoreDefinition"}, "Cores": [{"Id": "MyCoreId", "CertificateArn": {"Ref": "GreengrassCoreCert"}, "ThingArn": {"Ref": "GreengrassCoreThing"}, "SyncShadow": true}]}}, "DeviceDefinitionVersion": {"Type": "AWS::Greengrass::DeviceDefinitionVersion", "Properties": {"DeviceDefinitionId": {"Ref": "DeviceDefinition"}, "Devices": [{"Id": "MyDeviceId", "CertificateArn": {"Ref": "GreengrassDeviceCert"}, "ThingArn": {"Ref": "GreengrassDeviceThing"}, "SyncShadow": true}]}}, "FunctionDefinitionVersion": {"Type": "AWS::Greengrass::FunctionDefinitionVersion", "Properties": {"FunctionDefinitionId": {"Ref": "FunctionDefinition"}, "Functions": [{"Id": "MyFunctionId", "FunctionArn": {"Ref": "GreengrassLambdaFunctionArn"}, "FunctionConfiguration": {"EncodingType": "json", "Environment": {"ResourceAccessPolicies": [], "Variables": {}}, "Executable": "MyLambdaExecutable", "MemorySize": 32768, "Pinned": true, "Timeout": 3}}]}}, "ResourceDefinitionVersion": {"Type": "AWS::Greengrass::ResourceDefinitionVersion", "Properties": {"ResourceDefinitionId": {"Ref": "ResourceDefinition"}, "Resources": [{"Id": "MyResourceId", "Name": "MyResourceName", "ResourceDataContainer": {"LocalDeviceResourceData": {"SourcePath": "/source/path/to/device", "GroupOwnerSetting": {"AutoAddGroupOwner": false, "GroupOwner": "group-owner"}}}}]}}, "GreengrassLambdaFunctionArn": {"Type": "AWS::Lambda::Function", "Properties": {"FunctionName": "MyGreengrassLambdaFunction", "Handler": "index.handler", "Role": {"Ref": "LambdaExecutionRole"}, "Code": {"S3Bucket": "lambda-functions-bucket", "S3Key": "my-greengrass-lambda-function.zip"}, "Runtime": "nodejs20.x", "MemorySize": 128, "Timeout": 15}}, "LambdaExecutionRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": "lambda.amazonaws.com"}, "Action": "sts:AssumeRole"}]}, "Policies": [{"PolicyName": "GreengrassLambdaPolicy", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["logs:CreateLogGroup", "logs:CreateLogStream", "logs:PutLogEvents"], "Resource": "*"}, {"Effect": "Allow", "Action": ["greengrass:*"], "Resource": "*"}]}}]}}}, "Outputs": {"GreengrassGroupId": {"Description": "The ID of the Greengrass Group", "Value": {"Ref": "GreengrassGroup"}}, "GreengrassCoreArn": {"Description": "The ARN of the Greengrass Core Thing", "Value": {"Fn::GetAtt": ["GreengrassCoreThing", "Arn"]}}, "GreengrassDeviceArn": {"Description": "The ARN of the Greengrass Device Thing", "Value": {"Fn::GetAtt": ["GreengrassDeviceThing", "Arn"]}}, "GreengrassLambdaFunctionArn": {"Description": "The ARN of the Greengrass Lambda Function", "Value": {"Fn::GetAtt": ["GreengrassLambdaFunctionArn", "Arn"]}}}}