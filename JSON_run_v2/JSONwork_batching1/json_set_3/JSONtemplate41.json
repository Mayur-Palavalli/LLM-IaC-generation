{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraDBCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "admin", "MasterUserPassword": {"Fn::Sub": "{{resolve:ssm:DBMasterPassword:1}}"}, "DBClusterParameterGroupName": "default.aurora5.6", "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}]}}, "AuroraDBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBInstanceIdentifier": "aurora-instance1", "DBClusterIdentifier": {"Ref": "AuroraDBCluster"}, "DBInstanceClass": "db.t3.medium"}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "Subnet group for Aurora cluster", "SubnetIds": ["subnet-12345678", "subnet-87654321"]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow access to RDS instance", "VpcId": "vpc-12345678", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "DMSS3Bucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "dms-target-bucket"}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Allow DMS access", "VpcId": "vpc-12345678"}}, "DMSReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceIdentifier": "dms-instance", "ReplicationInstanceClass": "dms.r5.large", "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSReplicationSubnetGroup"}}}, "DMSReplicationSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "Subnet group for DMS", "SubnetIds": ["subnet-12345678", "subnet-87654321"]}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "aurora-source-endpoint", "EndpointType": "source", "EngineName": "aurora-mysql", "Username": "admin", "Password": {"Fn::Sub": "{{resolve:ssm:DBMasterPassword:1}}"}, "ServerName": {"Fn::GetAtt": ["AuroraDBCluster", "Endpoint.Address"]}, "Port": 3306}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "s3-target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "DMSS3Bucket"}, "ServiceAccessRoleArn": "arn:aws:iam::123456789012:role/dms-s3-access-role"}}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationTaskIdentifier": "dms-task", "SourceEndpointArn": {"Fn::GetAtt": ["DMSSourceEndpoint", "Id"]}, "TargetEndpointArn": {"Fn::GetAtt": ["DMSTargetEndpoint", "Id"]}, "ReplicationInstanceArn": {"Fn::GetAtt": ["DMSReplicationInstance", "Id"]}, "TableMappings": "{ \"rules\": [ { \"rule-type\": \"selection\", \"rule-id\": \"1\", \"rule-name\": \"1\", \"object-locator\": { \"schema-name\": \"%\", \"table-name\": \"%\" }, \"rule-action\": \"include\" } ] }"}}}, "Parameters": {"DBMasterPassword": {"Type": "String", "NoEcho": true, "Description": "The database admin account password"}}}