{"AWSTemplateFormatVersion": "2010-09-09", "Resources": {"AuroraCluster": {"Type": "AWS::RDS::DBCluster", "Properties": {"Engine": "aurora-mysql", "MasterUsername": "masteruser", "MasterUserPassword": {"Fn::Sub": "{{resolve:secretsmanager:arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:my-secret:SecretString:password}}"}, "DBSubnetGroupName": {"Ref": "DBSubnetGroup"}, "VpcSecurityGroupIds": [{"Ref": "DBSecurityGroup"}], "BackupRetentionPeriod": 7}}, "DBInstance": {"Type": "AWS::RDS::DBInstance", "Properties": {"DBClusterIdentifier": {"Ref": "AuroraCluster"}, "DBInstanceClass": "db.r5.large", "Engine": "aurora-mysql"}}, "DMSSubnetGroup": {"Type": "AWS::DMS::ReplicationSubnetGroup", "Properties": {"ReplicationSubnetGroupDescription": "DMS Subnet Group", "SubnetIds": ["subnet-0123456789abcdef0", "subnet-abcdef0123456789"]}}, "DMSSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "DMS Security Group", "VpcId": "vpc-0123456789abcdef0", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}, "ReplicationInstance": {"Type": "AWS::DMS::ReplicationInstance", "Properties": {"ReplicationInstanceClass": "dms.r5.large", "AllocatedStorage": 100, "VpcSecurityGroupIds": [{"Ref": "DMSSecurityGroup"}], "ReplicationSubnetGroupIdentifier": {"Ref": "DMSSubnetGroup"}}}, "DMSSourceEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "source-endpoint", "EndpointType": "source", "EngineName": "aurora", "Username": "masteruser", "Password": {"Fn::Sub": "${{resolve:secretsmanager:arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:my-secret:SecretString:password}}"}, "ServerName": {"Fn::GetAtt": ["AuroraCluster", "Endpoint.Address"]}, "Port": 3306, "DatabaseName": "mydatabase"}}, "DMSTargetEndpoint": {"Type": "AWS::DMS::Endpoint", "Properties": {"EndpointIdentifier": "target-endpoint", "EndpointType": "target", "EngineName": "s3", "S3Settings": {"BucketName": {"Ref": "DataBucket"}, "ServiceAccessRoleArn": "arn:aws:iam::123456789012:role/dms-s3-role"}}}, "DataBucket": {"Type": "AWS::S3::Bucket", "Properties": {"BucketName": "my-dms-data-bucket"}}, "DMSTask": {"Type": "AWS::DMS::ReplicationTask", "Properties": {"MigrationType": "full-load-and-cdc", "ReplicationInstanceArn": {"Ref": "ReplicationInstance"}, "SourceEndpointArn": {"Ref": "DMSSourceEndpoint"}, "TargetEndpointArn": {"Ref": "DMSTargetEndpoint"}, "TableMappings": "{\"rules\":[{\"rule-type\":\"selection\",\"rule-id\":\"1\",\"rule-name\":\"1\",\"object-locator\":{\"schema-name\":\"%\",\"table-name\":\"%\"},\"rule-action\":\"include\"}]}"}}, "DBSubnetGroup": {"Type": "AWS::RDS::DBSubnetGroup", "Properties": {"DBSubnetGroupDescription": "DB Subnet Group", "SubnetIds": ["subnet-0123456789abcdef0", "subnet-abcdef0123456789"]}}, "DBSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "DB Security Group", "VpcId": "vpc-0123456789abcdef0", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": 3306, "ToPort": 3306, "CidrIp": "0.0.0.0/0"}]}}}}